(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{452:function(s,a,e){"use strict";e.r(a);var n=e(28),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("Docker 官方文档: "),e("a",{attrs:{href:"https://docs.docker.com/install/linux/docker-ce/centos/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.docker.com/install/linux/docker-ce/centos/"),e("OutboundLink")],1)]),s._v(" "),e("h4",{attrs:{id:"dnf-和-yum-包管理器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dnf-和-yum-包管理器"}},[s._v("#")]),s._v(" DNF 和 YUM 包管理器")]),s._v(" "),e("p",[s._v("DNF 是对 YUM 的改写，虽然您可能会看到 YUM 在旧系统上使用，但它已停止使用，取而代之的是 DNF。现在没有太多理由去再探索 YUM。")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dnf 添加源 repo")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@hecs-366183 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询 repo")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@hecs-366183 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dnf repolist -v")]),s._v("\nLoaded plugins: builddep, changelog, config-manager, copr, debug, debuginfo-install, download, generate_completion_cache, groups-manager, needs-restarting, playground, repoclosure, repodiff, repograph, repomanage, reposync\nDNF version: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.10")]),s._v(".0\ncachedir: /var/cache/dnf\nDocker CE Stable - x86_64                                                                                 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("269")]),s._v("  B/s "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("385")]),s._v("  B     00:01\nErrors during downloading metadata "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" repository "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'docker-ce-stable'")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n  - Status code: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" https://download.docker.com/linux/centos/2.0/x86_64/stable/repodata/repomd.xml "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("IP: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("13.32")]),s._v(".50.74"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nError: Failed to download metadata "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" repo "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'docker-ce-stable'")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" Cannot download repomd.xml: Cannot download repodata/repomd.xml: All mirrors were tried\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@hecs-366183 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("发现报错了， 报 404 找不到这个地址：https://download.docker.com/linux/centos/2.0/x86_64/stable/repodata/repomd.xml")]),s._v(" "),e("p",[e("strong",[s._v("问题原因：")])]),s._v(" "),e("p",[s._v("第三方YUM源仅适配CentOS 7发行版，OpenEuler、Alibaba Cloud Linux 2 等操作系统与 CentOS 7 操作系统的 $releasever 值不同，导致 dnf 解析后的地址无效，从而下载容器软件包失败。")]),s._v(" "),e("p",[s._v("dnf 安装docker-ce软件包时，首先会在系统中获取版本号，即$releasever 值，然后替换相应YUM源中 baseurl 地址对应的$releasever 变量，dnf 从替换后的 baseurl 地址中获取相关数据。")]),s._v(" "),e("p",[s._v("由于 CentOS 7 操作系统的 $releasever 值为 7，Alibaba Cloud Linux 2操作系统的 $releasever 值为 2.0，因此解析后的 baseurl 地址并非预期地址，dnf 便无法从这个错误的地址中获取数据。")]),s._v(" "),e("h4",{attrs:{id:"解决方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[s._v("#")]),s._v(" 解决方案")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/yum.repos.d/docker-ce.repo\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("按i键切换至编辑模式，找到docker-ce.repo文件中所有enabled=1值的源，将源中baseurl地址的$releasever变量修改为7，修改之后的内容如下所示(注意和注释掉的 baseurl 不同的地方)。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("docker-ce-stable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Docker CE Stable - "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$basearch")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# baseurl=https://download.docker.com/linux/centos/$releasever/$basearch/stable")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("baseurl")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://download.docker.com/linux/centos/7/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$basearch")]),s._v("/stable\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgcheck")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgkey")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://download.docker.com/linux/centos/gpg\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("修改完成后，按下Esc键后，输入:wq并回车以保存并关闭配置文件，重新安装软件包即可。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出所有可用的docker-ce软件包")]),s._v("\ndnf list docker-ce --showduplicates "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" -r\n\ndnf makecache\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --nobest 筛选出最终符合要求的包来安装。不加 --nobest 可能会出错")]),s._v("\ndnf "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --nobest docker-ce -y\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. Start Docker")]),s._v("\nsystemctl start docker\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 开机自动启动")]),s._v("\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置镜像加速器")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 并且配置k8s运行要求docker的--cgroup-driver=systemd")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /etc/docker\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/docker/daemon.json "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'EOF\'\n{\n  "registry-mirrors": ["https://bfflggen.mirror.aliyuncs.com"],\n  "exec-opts": ["native.cgroupdriver=systemd"]\n}\nEOF')]),s._v("\n\nsystemctl daemon-reload\n\nsystemctl restart docker\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Uninstall Docker CE")]),s._v("\ndnf remove docker-ce\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);
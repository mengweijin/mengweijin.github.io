(window.webpackJsonp=window.webpackJsonp||[]).push([[164],{588:function(s,a,t){"use strict";t.r(a);var n=t(28),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h3",{attrs:{id:"背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),t("p",[s._v("小孟同学自己买了个服务器（2核4G），部署了一些 Java 应用在上面，但是最近服务经常自己就停止了。")]),s._v(" "),t("h3",{attrs:{id:"排查"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#排查"}},[s._v("#")]),s._v(" 排查")]),s._v(" "),t("h4",{attrs:{id:"查看系统-message-记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看系统-message-记录"}},[s._v("#")]),s._v(" 查看系统 message 记录")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ls log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /var/log")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ls log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat messages* |grep java")]),s._v("\nMay "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":18:34 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" kernel: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12777")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12777")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1225316")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("414774")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("943")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" java\nMay "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":18:34 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" kernel: Out of memory: Kill process "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12777")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" score "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("398")]),s._v(" or sacrifice child\nMay "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":18:34 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" kernel: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12777")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12777")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1225316")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("414844")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("943")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" java\nMay "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":18:34 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" kernel: Out of memory: Kill process "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12777")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" score "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("398")]),s._v(" or sacrifice child\nMay "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":18:34 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" kernel: Killed process "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12777")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", total-vm:4901264kB, anon-rss:1659376kB, file-rss:0kB, shmem-rss:0kB\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ls log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("可以看到是因为内存不足（ Out of memory）造成的。")]),s._v(" "),t("h4",{attrs:{id:"查看内存使用情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看内存使用情况"}},[s._v("#")]),s._v(" 查看内存使用情况")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ls log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# free -h")]),s._v("\n              total        used        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("      shared  buff/cache   available\nMem:           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".9G        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".4G        150M        912K        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1G        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1G\nSwap:            0B          0B          0B\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ls log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("确实所剩不多了")]),s._v(" "),t("h4",{attrs:{id:"解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[s._v("#")]),s._v(" 解决方案")]),s._v(" "),t("p",[s._v("由于资金有限，买高配置的服务器不现实。那么在不增加物理内存的情况下，启用swap交换区作为虚拟内存是一个不错的选择。")]),s._v(" "),t("p",[s._v("注意：如果使用 Kubernetes 的话，此方法不可行。安装 Kubernetes 必须关闭 swap。")]),s._v(" "),t("p",[s._v("参考文档："),t("a",{attrs:{href:"https://blog.csdn.net/weixin_29074295/article/details/116098867",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux 启用swap交换区作为虚拟内存"),t("OutboundLink")],1)]),s._v(" "),t("h4",{attrs:{id:"增加交换内存-swap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增加交换内存-swap"}},[s._v("#")]),s._v(" 增加交换内存 swap")]),s._v(" "),t("h5",{attrs:{id:"查看系统当前的分区情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看系统当前的分区情况"}},[s._v("#")]),s._v(" 查看系统当前的分区情况")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# free -h")]),s._v("\n              total        used        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("      shared  buff/cache   available\nMem:           972M        202M        661M        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".6M        107M        642M\nSwap:          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以看出，当前是没有启用 swap 交换区的。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h5",{attrs:{id:"创建用于交换分区的文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建用于交换分区的文件"}},[s._v("#")]),s._v(" 创建用于交换分区的文件")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先创建一个 swap 文件存放的文件夹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /home/swap\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建8GB的交换内存（一般大小设为为物理内存的两倍即可）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# (bs*count=文件大小) 会在 /home/swap/下创建名为 data-1 的文件（交换内存文件）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建需要一点时间，需要耐心等待")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/zero "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("of")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/swap/data-1 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bs")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1M "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把这个文件设置为交换分区文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkswap")]),s._v(" /home/swap/data-1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改文件权限为600")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /home/swap/data-1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用交换分区文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("swapon")]),s._v(" /home/swap/data-1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开机时自启用。若要想使开机时自启用，则需修改文件/etc/fstab 添加一行")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/fstab\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加以下内容：")]),s._v("\n/home/swap/data-1 swap swap defaults "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("h5",{attrs:{id:"关闭-swap-交换文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关闭-swap-交换文件"}},[s._v("#")]),s._v(" 关闭 swap 交换文件")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 swap 状态。Swap 为 0 说明没有开启 Swap")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# free -h")]),s._v("\n              total        used        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("      shared  buff/cache   available\nMem:           972M        202M        661M        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".6M        107M        642M\nSwap:          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时关闭全部 swap  ")]),s._v("\nswapoff -a\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭指定 swap")]),s._v("\nswapoff /home/swap/data-1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除 swap 文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f /home/swap/data-1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从 /etc/fstab 文件中删除追加的内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/fstab\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除（或注释掉）以下内容：")]),s._v("\n/home/swap/data-1 swap swap defaults "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h4",{attrs:{id:"使用-crontab-让应用自动重启"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-crontab-让应用自动重启"}},[s._v("#")]),s._v(" 使用 crontab 让应用自动重启")]),s._v(" "),t("p",[s._v("注意：脚本中 “source /etc/profile” 是因为 crontab 执行脚本无法取到环境变量，导致进程启动不起来，所以这个必须加上。")]),s._v(" "),t("p",[s._v("start.sh 和 monitor.sh 存放于 /root 目录下")]),s._v(" "),t("h5",{attrs:{id:"假如启动java进程脚本为-start-sh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#假如启动java进程脚本为-start-sh"}},[s._v("#")]),s._v(" 假如启动java进程脚本为：start.sh")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#! /bin/sh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\n \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -9 "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'project.jar'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $2}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" java -jar project.jar "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("project.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f project.log\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h5",{attrs:{id:"监控shell脚本-monitor-sh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监控shell脚本-monitor-sh"}},[s._v("#")]),s._v(" 监控shell脚本：monitor.sh")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#! /bin/sh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /root\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("procnum")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" project.jar"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$procnum")]),s._v(" -eq "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%Y-%m-%d"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%H:%M:%S"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"restart service"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("/root/logs/restart.log\n    ./start.sh\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h5",{attrs:{id:"将-monitor-sh-脚本加入-crontab"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#将-monitor-sh-脚本加入-crontab"}},[s._v("#")]),s._v(" 将 monitor.sh 脚本加入 crontab")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入crontab")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("crontab")]),s._v(" -e\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#填写一下内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开机自启动任务")]),s._v("\n@reboot /bin/sh /root/monitor.sh\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每分钟执行一次start.sh脚本")]),s._v("\n* * * * * /bin/sh /root/monitor.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("参考："),t("a",{attrs:{href:"https://blog.csdn.net/zheng911209/article/details/122913460",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/zheng911209/article/details/122913460"),t("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);
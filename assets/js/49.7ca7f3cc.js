(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{460:function(s,n,a){"use strict";a.r(n);var t=a(28),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"minikube-start"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#minikube-start"}},[s._v("#")]),s._v(" minikube start")]),s._v(" "),a("p",[s._v("官方文档："),a("a",{attrs:{href:"https://minikube.sigs.k8s.io/docs/start/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://minikube.sigs.k8s.io/docs/start/"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("由于国内网络原因，使用 aliyun 版本的 minikube: "),a("a",{attrs:{href:"https://github.com/AliyunContainerService/minikube",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/AliyunContainerService/minikube"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("Wiki: "),a("a",{attrs:{href:"https://github.com/AliyunContainerService/minikube/wiki",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/AliyunContainerService/minikube/wiki"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("文档："),a("a",{attrs:{href:"https://developer.aliyun.com/article/221687",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://developer.aliyun.com/article/221687"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"installation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#installation"}},[s._v("#")]),s._v(" Installation")]),s._v(" "),a("h3",{attrs:{id:"前提条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前提条件"}},[s._v("#")]),s._v(" 前提条件")]),s._v(" "),a("ul",[a("li",[s._v("配置了 163 repo 源")]),s._v(" "),a("li",[s._v("已经安装了Docker")]),s._v(" "),a("li",[s._v("关闭 CentOS中的防火墙")])]),s._v(" "),a("h3",{attrs:{id:"安装-conntrack"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-conntrack"}},[s._v("#")]),s._v(" 安装 conntrack")]),s._v(" "),a("p",[s._v("在Vmware中的CentOS 下启动minikube, 需要安装 conntrack, 解决方法：下载yum源，安装依赖包")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/yum.repos.d/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://mirrors.aliyun.com/repo/epel-7.repo\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://mirrors.aliyun.com/repo/Centos-7.repo\nyum clean all "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" yum makecache\nyum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" epel-release "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" conntrack-tools\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"k8s运行要求docker的-cgroup-driver-systemd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s运行要求docker的-cgroup-driver-systemd"}},[s._v("#")]),s._v(" k8s运行要求docker的--cgroup-driver=systemd")]),s._v(" "),a("ul",[a("li",[s._v("配置Docker镜像加速器")]),s._v(" "),a("li",[s._v("您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器")]),s._v(" "),a("li",[s._v("并且配置k8s运行要求docker的--cgroup-driver=systemd")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /etc/docker\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/docker/daemon.json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'EOF\'\n{\n  "registry-mirrors": ["https://bfflggen.mirror.aliyuncs.com"],\n  "exec-opts": ["native.cgroupdriver=systemd"]\n}\nEOF')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart docker\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"关闭selinux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭selinux"}},[s._v("#")]),s._v(" 关闭selinux")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看selinux是否关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7 yum.repos.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# getenforce")]),s._v("\nEnforcing "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Enforcing 为未关闭")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先设置当前环境临时关闭，就不用重启操作系统了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7 yum.repos.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# setenforce 0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7 yum.repos.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# getenforce")]),s._v("\nPermissive "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Permissive 已关闭")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后设置永久关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7 yum.repos.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/sysconfig/selinux")]),s._v("\n设置：SELINUX"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("disabled\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7 yum.repos.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/sysconfig/selinux")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This file controls the state of SELinux on the system.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SELINUX= can take one of these three values:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     enforcing - SELinux security policy is enforced.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     permissive - SELinux prints warnings instead of enforcing.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     disabled - No SELinux policy is loaded.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这一行显示为 disabled.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SELINUX")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("disabled\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SELINUXTYPE= can take one of three values:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     targeted - Targeted processes are protected,")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     minimum - Modification of targeted policy. Only selected processes are protected.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     mls - Multi Level Security protection.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SELINUXTYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("targeted\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("h3",{attrs:{id:"关闭swap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭swap"}},[s._v("#")]),s._v(" 关闭swap")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# k8s要求系统关闭，否则安装过程会报错")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看系统是否关闭了swap")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7 yum.repos.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":43:28 up  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":55,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" users,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.15")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.21")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.29")]),s._v("\nTasks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("113")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" running, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("112")]),s._v(" sleeping,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" stopped,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" zombie\n%Cpu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("98.3")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\nKiB Mem "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1863032")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("623164")]),s._v(" free,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("411380")]),s._v(" used,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("828488")]),s._v(" buff/cache\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面这一行表示 swap 没有关闭")]),s._v("\nKiB Swap:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2097148")]),s._v(" total,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2095348")]),s._v(" free,     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1800")]),s._v(" used.  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1277688")]),s._v(" avail Mem\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先设置当前环境临时关闭，就不用重启操作系统了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7 yum.repos.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# swapoff -a")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7 yum.repos.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":49:05 up  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":00,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" users,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.06")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.12")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.22")]),s._v("\nTasks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("118")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" running, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("117")]),s._v(" sleeping,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" stopped,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" zombie\n%Cpu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.1")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\nKiB Mem "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1863032")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("622488")]),s._v(" free,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("409664")]),s._v(" used,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("830880")]),s._v(" buff/cache\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面这一行表示 swap 已经关闭。都是 0")]),s._v("\nKiB Swap:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" total,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" free,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" used.  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1279404")]),s._v(" avail Mem\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后设置永久关闭。注释掉swap那一行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7 yum.repos.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/fstab")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7 yum.repos.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/fstab")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /etc/fstab")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Created by anaconda on Tue Mar 23 18:33:21 2021")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Accessible filesystems, by reference, are maintained under '/dev/disk'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n/dev/mapper/centos-root /                       xfs     defaults        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UUID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ae5b7810-0161-4858-98e4-799b61266440 /boot                   xfs     defaults        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面这一行前面添加了 # 号，注释掉了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/dev/mapper/centos-swap swap                    swap    defaults        0 0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("h3",{attrs:{id:"安装-kubectl-并配置-kubernetes-repo-源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-kubectl-并配置-kubernetes-repo-源"}},[s._v("#")]),s._v(" 安装 kubectl 并配置 kubernetes.repo 源")]),s._v(" "),a("h4",{attrs:{id:"配置-kubernetes-repo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-kubernetes-repo"}},[s._v("#")]),s._v(" 配置 kubernetes.repo")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/yum.repos.d/kubernetes.repo")]),s._v("\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nEOF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/yum.repos.d\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看文件：kubernetes.repo")]),s._v("\nll\n\nyum clean all "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" yum makecache\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查是否安装成功")]),s._v("\nyum repolist\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h4",{attrs:{id:"安装-kubectl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-kubectl"}},[s._v("#")]),s._v(" 安装 kubectl")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y kubectl\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7 yum.repos.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl version")]),s._v("\nClient Version: version.Info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("Major:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(", Minor:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"20"')]),s._v(", GitVersion:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1.20.5"')]),s._v(", GitCommit:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6b1d87acf3c8253c123756b9e61dac642678305f"')]),s._v(", GitTreeState:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clean"')]),s._v(", BuildDate:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2021-03-18T01:10:43Z"')]),s._v(", GoVersion:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go1.15.8"')]),s._v(", Compiler:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gc"')]),s._v(", Platform:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux/amd64"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nThe connection to the server localhost:8080 was refused - did you specify the right "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" or port?\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"启动-minikube"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动-minikube"}},[s._v("#")]),s._v(" 启动 minikube")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Minikube 还支持使用一个 --vm-driver=none 选项，让 Kubernetes 组件运行在主机中，而不是在 VM 中。 使用这种驱动方式需要 Docker 和 Linux 环境，但不需要 hypervisor，但 none 不支持 Ingress, 一般使用 --vm-driver=docker。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 但此处使用 --vm-driver=docker 会有这个问题：The "docker" driver should not be used with root privileges')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 于是创建用户（或者有非root用户，可以不用创建新用户）：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" mengweijin\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置密码，回车后，输入两边密码")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" mengweijin\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载 minikube aliyun 版本。最新版本的 minikube 参考本文最前面章节的链接。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -Lo minikube https://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v1.18.1/minikube-linux-amd64 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x minikube "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" minikube /usr/local/bin/\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里一定使用 mengweijin 用户登录，然后 切换到 root 用户执行以下命令：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将您的用户添加到该docker组。激活对组的更改：newgrp docker")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果后面依然报这个错，再次切换到root执行该命令，然后再切换回mengweijin用户继续执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v(" -aG docker "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" newgrp docker\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再切换为刚创建的用户，然后启动minikube")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" mengweijin \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正式启动（记得每次切换为 mengweijin用户启动）")]),s._v("\nminikube start --vm-driver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("docker --cpus"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" --memory"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("4096mb\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# start 日志如下")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mengweijin@centos7 bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ minikube start --vm-driver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("docker\n* Centos "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.9")]),s._v(".2009 上的 minikube v1.17.1\n* 根据用户配置使用 docker 驱动程序\n\nX Requested memory allocation "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("1819MB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" is "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("less")]),s._v(" than the recommended minimum 1900MB. Deployments may fail.\n\n\nX The requested memory allocation of 1819MiB does not leave room "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" system overhead "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("total system memory: 1819MiB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(". You may face stability issues.\n* 建议：Start minikube with "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("less")]),s._v(" memory allocated: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'minikube start --memory=1819mb'")]),s._v("\n\n* Starting control plane node minikube "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" cluster minikube\n* Pulling base image "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n* Creating docker container "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CPUs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Memory")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1819MB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kubectl: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38.37")]),s._v(" MiB / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38.37")]),s._v(" MiB "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-------------"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("902.39")]),s._v(" KiB p/s 43s\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kubelet: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("108.73")]),s._v(" MiB / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("108.73")]),s._v(" MiB "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("------------"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.82")]),s._v(" MiB p/s 1m0s\n  - Generating certificates and keys "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  - Booting up control plane "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  - Configuring RBAC rules "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n* Verifying Kubernetes components"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n* Enabled addons: default-storageclass, storage-provisioner\n* Done"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" kubectl is now configured to use "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"minikube"')]),s._v(" cluster and "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v(" namespace by default\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装完毕后，在命令行输入以下命令来验证是否安装成功。")]),s._v("\nminikube status\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Linux 下如果没有安装 kubectl, 可以这样使用 kubectl 命令（建议安装）：")]),s._v("\nminikube kubectl -- get po -A\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果安装了，这样查询")]),s._v("\nkubectl get po -A\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开Kubernetes控制台(mengweijin用户)")]),s._v("\nminikube dashboard\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7 yum.repos.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# minikube dashboard")]),s._v("\n* 正在开启 dashboard "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n* 正在验证 dashboard 运行情况 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n* Launching proxy "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n* 正在验证 proxy 运行状况 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nhttp://127.0.0.1:36524/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时，不能关闭当前进程和窗口，由于是在Vmware中的CentOS启动的dashboard, 要在Windows下的浏览器中访问：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用SSH工具新开一个连接窗口，开启代理(mengweijin用户) ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kube-proxy 端口转发")]),s._v("\nkubectl proxy --address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 --disable-filter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl proxy --address='0.0.0.0' --disable-filter=true")]),s._v("\nW0323 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":23:25.795951   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38729")]),s._v(" proxy.go:167"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Request filter disabled, your proxy is vulnerable to XSRF attacks, please be cautious\nStarting to serve on "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":8001\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 依然不能关闭当前进程和窗口，Windows 浏览器访问 dashboard：")]),s._v("\nhttp://"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("CentOS虚拟机的IP"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("端口为上面proxy中显示的端口，默认800"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("/api/v1/namespaces/"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("服务的namespace"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/services/http:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("服务名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("服务端口"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/proxy/\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Windows 浏览器访问示例：")]),s._v("\nhttp://192.168.171.131:8001/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("kubectl proxy")]),s._v(" "),a("p",[s._v("让外部网络访问K8S service的ClusterIP")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用kubectl proxy命令就可以使API server监听在本地的8001端口上：")]),s._v("\nkubectl proxy\nStarting to serve on "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:8001\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果想通过其它主机访问就需要指定监听的地址：")]),s._v("\nkubectl proxy --address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时通过curl访问会出现未认证的提示：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X GET -L http://k8s-master:8009/\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("h"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v(">")]),s._v("Unauthorized"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/h"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置API server接收所有主机的请求：")]),s._v("\nkubectl proxy --address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0.0.0.0'")]),s._v(" --accept-hosts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^*$'")]),s._v("\nStarting to serve on "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":8001\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问正常：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X GET -L http://k8s-master:8009/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"paths"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/api"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/api/v1"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定一个端口：")]),s._v("\nkubectl proxy --address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0.0.0.0'")]),s._v(" --accept-hosts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^*$'")]),s._v(" --port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8009")]),s._v("\nStarting to serve on "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":8009\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于未认证的问题，干脆禁用：")]),s._v("\nkubectl proxy --address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0.0.0.0'")]),s._v(" --disable-filter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])])]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("minikube aliyun 说明")]),s._v(" "),a("p",[s._v("为了访问海外的资源，阿里云提供了一系列基础设施，请按照如下参数进行配置。其中常见参数")]),s._v(" "),a("ul",[a("li",[s._v("--driver=*** 从1.5.0版本开始，Minikube缺省使用本地最好的驱动来创建Kubernetes本地环境，测试过的版本 docker, kvm")]),s._v(" "),a("li",[s._v("--image-mirror-country cn 将缺省利用 registry.cn-hangzhou.aliyuncs.com/google_containers 作为安装Kubernetes的容* 器镜像仓库 （阿里云版本可选）")]),s._v(" "),a("li",[s._v("--iso-url=*** 利用阿里云的镜像地址下载相应的 .iso 文件 （阿里云版本可选）")]),s._v(" "),a("li",[s._v("--registry-mirror=***为了拉取Docker Hub镜像，需要为 Docker daemon 配置镜像加速，参考阿里云镜像服务")]),s._v(" "),a("li",[s._v("--cpus=2: 为minikube虚拟机分配CPU核数")]),s._v(" "),a("li",[s._v("--memory=2048mb: 为minikube虚拟机分配内存数")]),s._v(" "),a("li",[s._v("--kubernetes-version=***: minikube 虚拟机将使用的 kubernetes 版本")])])]),s._v(" "),a("h2",{attrs:{id:"启用-ingress"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启用-ingress"}},[s._v("#")]),s._v(" 启用 Ingress")]),s._v(" "),a("p",[s._v("官方文档："),a("a",{attrs:{href:"https://kubernetes.io/zh/docs/tasks/access-application-cluster/ingress-minikube/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://kubernetes.io/zh/docs/tasks/access-application-cluster/ingress-minikube/"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用时较长，耐心等待，如果第一遍开启失败，多尝试几遍")]),s._v("\nminikube addons "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" ingress\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看")]),s._v("\nminikube addons list\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查验证 NGINX Ingress 控制器处于运行状态")]),s._v("\nkubectl get pods -n kube-system\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"部署-nginx-yaml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署-nginx-yaml"}},[s._v("#")]),s._v(" 部署 nginx.yaml")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.16.1\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# IfNotPresent, Always, Never")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# #如果使用Ingress, 这里可以不通过NodePort暴露端口,即可以注释掉。这里为了测试Service, 所以暴露出来")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NodePort\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认情况下，为了方便起见，`targetPort` 被设置为与 `port` 字段相同的值。")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Ingress\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定了我们使用后端ingress controller的类别，如果后端有多个ingress controller的时候很重要")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kubernetes.io/ingress.class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx.ingress.kubernetes.io/rewrite-target: /$1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mengweijin.com\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pathType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Prefix\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("说明")]),s._v(" "),a("p",[s._v("查看当前可用的API版本")]),s._v(" "),a("p",[s._v("kubectl api-versions")]),s._v(" "),a("p",[s._v("关于限制cpu和内存，建议学习环境不要限制，限制了容易启动卡死，必须分配足够的资源才行。")]),s._v(" "),a("p",[s._v("minikube ssh : 进入 Docker 容器")])]),s._v(" "),a("p",[s._v("执行部署命令：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --record 标志将所执行的命令写入资源注解 kubernetes.io/change-cause 中。 这对于以后的检查是有用的。例如，要查看针对每个 Deployment 修订版本所执行过的命令。")]),s._v("\nkubectl apply -f nginx.yaml --record\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"使用-service-访问应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-service-访问应用"}},[s._v("#")]),s._v(" 使用 Service 访问应用")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方式一 VMware 虚拟机中访问")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示访问 service 的 url: 然后把这个 url 放到浏览器里")]),s._v("\nminikube "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx --url\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# port 通过 kubectl get service nginx 查看")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" url:port\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方式二 Windows 下访问")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者通过 kubectl port-forward 端口转发的方式访问 K8S 中的应用")]),s._v("\nkubectl port-forward service/nginx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7000")]),s._v(":80\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Windows 下访问（或用浏览器访问 mengweijin.com）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://localhost:7000\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方式三 Windows 下访问")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kube-proxy 端口转发（在新的 ssh 窗口下运行），转发端口：8001")]),s._v("\nkubectl proxy --address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 --disable-filter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Windows 下访问：")]),s._v("\nhttp://192.168.171.131:8001/api/v1/namespaces/default/services/http:nginx:80/proxy/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h3",{attrs:{id:"使用-ingress-访问应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-ingress-访问应用"}},[s._v("#")]),s._v(" 使用 Ingress 访问应用")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl get ingress\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 命令行输出")]),s._v("\nPS C:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("mengweijin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Documents"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("MobaXterm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kubectl get ingress\nNAME    CLASS    HOSTS            ADDRESS        PORTS   AGE\nnginx   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   mengweijin.com   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".49.2   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("      14m\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"ingress-中没有配置host路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ingress-中没有配置host路由"}},[s._v("#")]),s._v(" Ingress 中没有配置host路由")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果 Ingress 中没有配置host路由： host: mengweijin.com，直接可以使用如下IP访问到。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".49.2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"ingress-中配置了host路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ingress-中配置了host路由"}},[s._v("#")]),s._v(" Ingress 中配置了host路由")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# （root用户）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/hosts\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 hosts 文件的末尾添加以下内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".49.2 mengweijin.com\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使hosts立刻生效")]),s._v("\n/etc/init.d/network restart\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 说明： 如果你在本地运行 Minikube 环境，需要使用下面命令获得外部 IP 地址。 Ingress 列表中显示的 IP 地址会是内部 IP 地址。")]),s._v("\nminikube "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 ingress 映射详情")]),s._v("\nkubectl describe ingress nginx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在CentOS虚拟机中访问（或用CentOS中的浏览器访问 mengweijin.com）能看到 nginx 首页")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" mengweijin.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h3",{attrs:{id:"windows-浏览器访问-ingress-服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#windows-浏览器访问-ingress-服务"}},[s._v("#")]),s._v(" Windows 浏览器访问 ingress 服务")]),s._v(" "),a("p",[s._v("类似于访问 dashboard, 开启 proxy 后：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("http://192.168.171.131:8001/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 照猫画虎")]),s._v("\nhttp://192.168.171.131:8001/api/v1/namespaces/default/services/http:nginx:/proxy/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"manage-your-cluster"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#manage-your-cluster"}},[s._v("#")]),s._v(" Manage your cluster")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Pause Kubernetes without impacting deployed applications:")]),s._v("\nminikube pause\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Halt the cluster:")]),s._v("\nminikube stop\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Increase the default memory limit (requires a restart):")]),s._v("\nminikube config "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" memory "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Browse the catalog of easily installed Kubernetes services:")]),s._v("\nminikube addons list\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Create a second cluster running an older Kubernetes release:")]),s._v("\nminikube start -p aged --kubernetes-version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v1.16.1\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Delete all of the minikube clusters:")]),s._v("\nminikube delete --all\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h2",{attrs:{id:"kubectl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubectl"}},[s._v("#")]),s._v(" kubectl")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl version\nkubectl get namespace\nkubectl get nodes\nkubectl describe node nodeName\nkubectl apply -f nginx.yaml --record\nkubectl get deployment\nkubectl get deployments\nkubectl get pods\nkubectl get pods -o wide\nkubectl get pods --all-namespaces\nkubectl get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\nkubectl get all\nkubectl get all --all-namespaces\nkubectl describe pod nginx\nkubectl delete -f nginx.yaml\nkubectl delete deployment nginx\nkubectl delete "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx\nkubectl logs -f podName\nkubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it podName -- /bin/bash\nkubectl port-forward service/nginx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7000")]),s._v(":8888\nkubectl describe "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("quota")]),s._v("                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前 namespace 下的cpu, memory, storage 的限制和使用情况")]),s._v("\nkubectl get pods/podname -o yaml\nkubectl get deployment ingress-nginx-controller -n kube-system -o yaml\nkubectl get deployment ingress-nginx-controller -n kube-system -o yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ingress-nginx-controller-deploy.yaml\n--enable-ssl-passthrough\n\nkubectl patch deployment ingress-nginx-controller --patch "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ingress-nginx-patch.yaml"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" -n kube-system \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监控 ingress-nginx-controller 日志")]),s._v("\nkubectl get pods -n kube-system\nkubectl -n kube-system logs -f ingress-nginx-controller-84db5fd745-xqdc4\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 ingress-nginx-controller pod 中可以测试请求外面的服务")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -n kube-system "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ingress pod"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -v "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("service name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":8080\n\nkubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it -n kube-system ingress-nginx-controller-6c8559fd4d-2r8xf -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/nginx/nginx.conf\n\nkubectl label namespace default istio-injection-\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从本地复制 aaa.txt 文件到 容器 application-demo-deployment-823726322c-9ssfd9 中的 /tmp 目录下")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -n default aaa.txt application-demo-deployment-823726322c-9ssfd9:/tmp\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从Pod容器中copy文件至本地")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("some-namespace"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("some-pod"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("root_dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("parent_dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/temp/lalalaB ./lalalaC\nkubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" default/cloud-786d84c554-p7jz7:app/logs/app/cloud.log cloud.log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br")])]),a("h2",{attrs:{id:"k8s-对外暴露服务的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s-对外暴露服务的方法"}},[s._v("#")]),s._v(" k8s 对外暴露服务的方法")]),s._v(" "),a("p",[s._v("向 k8s 集群外部暴露服务的方式有三种： nodePort，LoadBalancer 和本文要介绍的 Ingress。每种方式都有各自的优缺点。")]),s._v(" "),a("ul",[a("li",[s._v("nodePort 方式在服务变多的情况下会导致节点要开的端口越来越多，不好管理。")]),s._v(" "),a("li",[s._v("LoadBalancer 更适合结合云提供商的 LB 来使用，但是在 LB 越来越多的情况下对成本的花费也是不可小觑。")]),s._v(" "),a("li",[s._v("Ingress 是 k8s 官方提供的用于对外暴露服务的方式，也是在生产环境用的比较多的方式，一般在云环境下是 LB + Ingress Controller 方式对外提供服务，这样就可以在一个 LB 的情况下根据域名路由到对应后端的 Service，有点类似于 Nginx 反向代理，只不过在 k8s 集群中，这个反向代理是集群外部流量的统一入口。")])]),s._v(" "),a("h2",{attrs:{id:"k8s-中同一集群服务之间的访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s-中同一集群服务之间的访问"}},[s._v("#")]),s._v(" K8S 中同一集群服务之间的访问")]),s._v(" "),a("h3",{attrs:{id:"k8s的服务名dns解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s的服务名dns解析"}},[s._v("#")]),s._v(" k8s的服务名DNS解析")]),s._v(" "),a("p",[s._v("Kubernetes 目前使用的kube-dns来实现集群内部的service dns记录解析。默认情况下/etc/resolv.conf里，它的内容是统一的格式。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# more /etc/resolv.conf")]),s._v("\nnameserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.10\nsearch saas.svc.cluster.local svc.cluster.local cluster.local\noptions ndots:5\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("search doamin列表默认情况下，它只包含本地域名。这可以通过在search关键字后面列出所需的域搜索路径来添加。kubernetes为每个容器配置默认是${namespace}.svc.cluster.local svc.cluster.local cluster.local。在一次dns域名查询时，将会尝试使用每个search doamin依次搜索少于ndots点（默认值为1）的解析器查询，直到找到匹配项。对于具有多个子域的环境，建议调整选项ndots:n，以避免man-in-the-middle攻击和root-dns-servers的不必要通信。")]),s._v(" "),a("p",[s._v("这个我们可以把它理解成服务名dns解析的层次，例如{服务名}是一级，而{服务名}.{命名空间}为二层，{服务名}.{命名空间}.svc.cluster.local是第三层，上面的配置一共有5层，同时也开启了5层，这样做可以保证最大限度的找到你的服务，但对于解析的性能是有影响的。")]),s._v(" "),a("h3",{attrs:{id:"同一-namespace-下的-pod-之间的访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同一-namespace-下的-pod-之间的访问"}},[s._v("#")]),s._v(" 同一 namespace 下的 pod 之间的访问")]),s._v(" "),a("p",[s._v("假如 A 服务(serviceName=aaaa) 调用 B 服务(serviceName=bbbb)中的接口：http://localhost:8080/test")]),s._v(" "),a("p",[s._v("那么在 A 工程中可以通过 B 服务的 serviceName 来调用 B 服务。例如在 A 服务中配置 B 服务中的接口格式为：http://bbbb:8080/test")]),s._v(" "),a("h3",{attrs:{id:"跨-namespace-下的-pod-之间的访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨-namespace-下的-pod-之间的访问"}},[s._v("#")]),s._v(" 跨 namespace 下的 pod 之间的访问")]),s._v(" "),a("p",[s._v("假如 A 服务(namespace=ns1, serviceName=aaaa) 调用 B 服务(namespace=ns2, serviceName=bbbb)中的接口：http://localhost:8080/test")]),s._v(" "),a("p",[s._v("A 服务调用 B 服务的调用方式为：http://bbbb.ns2:8080/test")])])}),[],!1,null,null,null);n.default=e.exports}}]);
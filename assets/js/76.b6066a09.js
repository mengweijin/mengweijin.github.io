(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{494:function(a,t,s){"use strict";s.r(t);var n=s(28),e=Object(n.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("JDK 为我们提供的工具 这些工具在 windows 上，就是这些 exe，其他的平台不同。C:\\Program Files\\Java\\jdk1.8.0_251\\bin")]),a._v(" "),s("p",[a._v("在 linux 中，一般自带了 OpenJdk，一般情况下 JPS 等命令不能用，要么选择去安装 JPS 等插件，要么把 OpenJdk 卸载，去重新安装 Oracle 的 JDK，我推荐后者。")]),a._v(" "),s("h2",{attrs:{id:"命令行工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#命令行工具"}},[a._v("#")]),a._v(" 命令行工具")]),a._v(" "),s("h3",{attrs:{id:"jps"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jps"}},[a._v("#")]),a._v(" jps")]),a._v(" "),s("p",[a._v("列出当前机器上正在运行的虚拟机进程，JPS 从操作系统的临时目录上去找（所以有一些信息可能显示不全）。")]),a._v(" "),s("ul",[s("li",[a._v("-q: 仅仅显示进程，")]),a._v(" "),s("li",[a._v("-m: 输出主函数传入的参数. 下的 hello 就是在执行程序时从命令行输入的参数")]),a._v(" "),s("li",[a._v("-l: 输出应用程序主类完整 package 名称或 jar 完整名称.")]),a._v(" "),s("li",[a._v("-v: 列出 jvm 参数, -Xms20m -Xmx50m 是启动程序指定的 jvm 参数")])]),a._v(" "),s("h3",{attrs:{id:"jstat"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jstat"}},[a._v("#")]),a._v(" jstat")]),a._v(" "),s("p",[a._v("是用于监视虚拟机各种运行状态信息的命令行工具。它可以显示本地或者远程虚拟机进程中的类装载、内存、垃圾收集、JIT 编译等运行数据，在没有 GUI 图形界面，只提供了纯文本控制台环境的服务器上，它将是运行期定位虚拟机性能问题的首选工具。 常用参数：\n-class (类加载器)\n-compiler (JIT)\n-gc (GC 堆状态)\n-gccapacity (各区大小)\n-gccause (最近一次 GC 统计和原因)\n-gcnew (新区统计)\n-gcnewcapacity (新区大小)\n-gcold (老区统计)\n-gcoldcapacity (老区大小)\n-gcpermcapacity (永久区大小)\n-gcutil (GC 统计汇总)\n-printcompilation (HotSpot 编译统计)")]),a._v(" "),s("p",[a._v("比如说：我们要统计 GC，就是垃圾回收，那么只需要使用这样的命令。 jstat -gc 13616 （这个 13616 是 JVM 的进程，通过 JPS 命令得到），这样统计出来是的实时值。所以很多情况下，我们为了看变化值的，可以这么玩。")]),a._v(" "),s("p",[a._v("假设需要每 250 毫秒查询一次进程 13616 垃圾收集状况，一共查询 10 次，那命令应当是：jstat-gc 13616 250 10\nS0C：第一个幸存区（From 区）的大小\nS1C：第二个幸存区（To 区）的大小\nS0U：第一个幸存区的使用大小\nS1U：第二个幸存区的使用大小\nEC：伊甸园（Eden）区的大小\nEU：伊甸园（Eden）区的使用大小\nOC：老年代大小\nOU：老年代使用大小\nMC：方法区大小\nMU：方法区使用大小\nCCSC:压缩类空间大小\nCCSU:压缩类空间使用大小\nYGC：年轻代垃圾回收次数\nYGCT：年轻代垃圾回收消耗时间\nFGC：老年代垃圾回收次数\nFGCT：老年代垃圾回收消耗时间\nGCT：垃圾回收消耗总时间")]),a._v(" "),s("h3",{attrs:{id:"jinfo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jinfo"}},[a._v("#")]),a._v(" jinfo")]),a._v(" "),s("p",[a._v("查看和修改虚拟机的参数。命令：jinfo -sysprops 11728\njinfo –sysprops 可以查看由 System.getProperties()取得的参数\njinfo –flag 未被显式指定的参数的系统默认值\njinfo –flags（注意 s）显示虚拟机的参数")]),a._v(" "),s("h4",{attrs:{id:"vm-参数分类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vm-参数分类"}},[a._v("#")]),a._v(" VM 参数分类")]),a._v(" "),s("p",[a._v("JVM 的命令行参数参考："),s("a",{attrs:{href:"https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("该java  命令支持各种选项，这些选项可以分为以下几类：")]),a._v(" "),s("ul",[s("li",[a._v("标准选项")]),a._v(" "),s("li",[a._v("非标准选项")]),a._v(" "),s("li",[a._v("高级运行时选项")])]),a._v(" "),s("ol",[s("li",[a._v("标准： - 开头，所有的 HotSpot 都支持")])]),a._v(" "),s("p",[a._v("保证 Java 虚拟机（JVM）的所有实现都支持标准选项。它们用于执行常见操作，例如检查 JRE 版本，设置类路径，启用详细输出等")]),a._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[a._v("非标准：-X 开头，特定版本 HotSpot 支持特定命令")])]),a._v(" "),s("p",[a._v("非标准选项是特定于 Java HotSpot 虚拟机的通用选项，因此不能保证所有 JVM 实现都支持它们，并且它们可能会发生变化。这些选项以开头-X。 -Xms30m -Xmx30m -Xss1m")]),a._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[a._v("高级选项：以开头-XX:")])]),a._v(" "),s("p",[a._v("这些是开发人员选项，用于调整 Java HotSpot 虚拟机操作的特定区域，这些区域通常具有特定的系统要求，并且可能需要对系统配置参数的特权访问。也不能保证所有 JVM 实现都支持它们，并且它们可能会发生变化。")]),a._v(" "),s("p",[a._v("在 windows 上可以通过以下 java -XX:+PrintFlagsFinal –version 查询所有-XX 的")]),a._v(" "),s("p",[s("strong",[a._v("注意：manageable 的参数，代表可以运行时修改。")])]),a._v(" "),s("p",[a._v("演示例子如下： 首先我们得知 PrintGC 这个 XX 参数是可以运行时修改的。")]),a._v(" "),s("p",[a._v("jinfo –flag -[参数] pid 可以修改参数")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看 PrintGC 是否开启，减号为关闭状态")]),a._v("\nC:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Source"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("code"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("gitee"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("quickboot"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("jinfo -flag PrintGC "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("13588")]),a._v("\n-XX:-PrintGC\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 开启")]),a._v("\nC:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Source"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("code"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("gitee"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("quickboot"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("jinfo -flag +PrintGC "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("11728")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 再次查看，变成了加号")]),a._v("\nC:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Source"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("code"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("gitee"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("quickboot"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("jinfo -flag PrintGC "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("11728")]),a._v("\n-XX:+PrintGC\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("p",[a._v("总结：通过 jinfo 命令，我可以在生产上临时打开一下 GC 日志或者进行一些数据的配置。（不需要重启应用条件下），也是我们去排查问题的一个关键命令。")]),a._v(" "),s("h3",{attrs:{id:"jmap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jmap"}},[a._v("#")]),a._v(" jmap")]),a._v(" "),s("p",[a._v("用于生成堆转储快照（一般称为 heapdump 或 dump 文件）。jmap 的作用并不仅仅是为了获取 dump 文件，它还可以查询 finalize 执行队列、Java 堆和永久代的详细信息，如空间使用率、当前用的是哪种收集器等。和 jinfo 命令一样，jmap 有不少功能在 Windows 平台下都是受限的，除了生成 dump 文件的 -dump 选项和用于查看每个类的实例、空间占用统计的-histo 选项在所有操作系统都提供之外，其余选项都只能在 Linux/Solaris 下使用。")]),a._v(" "),s("h4",{attrs:{id:"heap-打印-heap-的概要信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#heap-打印-heap-的概要信息"}},[a._v("#")]),a._v(" -heap 打印 heap 的概要信息")]),a._v(" "),s("p",[a._v("jmap –heap <pid>")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("Heap Configuration: ##堆配置情况，也就是 JVM 参数配置的结果[平常说的 tomcat 配置 JVM 参数，就是在配置这些] \n    MinHeapFreeRatio = 40 ##最小堆使用比例 \n    MaxHeapFreeRatio = 70 ##最大堆可用比例 \n    MaxHeapSize = 2147483648 (2048.0MB) ##最大堆空间大小 \n    NewSize = 268435456 (256.0MB) ##新生代分配大小 \n    MaxNewSize = 268435456 (256.0MB) ##最大可新生代分配大小 \n    OldSize = 5439488 (5.1875MB) ##老年代大小 \n    NewRatio = 2 ##新生代比例 \n    SurvivorRatio = 8 ##新生代与 suvivor 的比例 \n    PermSize = 134217728 (128.0MB) ##perm 区永久代大小 \n    MaxPermSize = 134217728 (128.0MB) ##最大可分配 perm 区 也就是永久代大小 \nHeap Usage: ##堆使用情况【堆内存实际的使用情况】 \n    New Generation (Eden + 1 Survivor Space): ##新生代（伊甸区 Eden 区 + 幸存区 survior(1+2)空间） \n    capacity = 241631232 (230.4375MB) ##伊甸区容量 \n    used = 77776272 (74.17323303222656MB) ##已经使用大小 \n    free = 163854960 (156.26426696777344MB) ##剩余容量 \n    32.188004570534986% used ##使用比例 \nEden Space: ##伊甸区 \n    capacity = 214827008 (204.875MB) ##伊甸区容量 \n    used = 74442288 (70.99369812011719MB) ##伊甸区使用 \n    free = 140384720 (133.8813018798828MB) ##伊甸区当前剩余容量 \n    34.65220164496263% used ##伊甸区使用情况 \nFrom Space: ##survior1 区 \n    capacity = 26804224 (25.5625MB) ##survior1 区容量 \n    used = 3333984 (3.179534912109375MB) ##surviror1 区已使用情况\n    free = 23470240 (22.382965087890625MB) ##surviror1 区剩余容量 \n    12.43827838477995% used ##survior1 区使用比例 \nTo Space: ##survior2 区 \n    capacity = 26804224 (25.5625MB) ##survior2 区容量 \n    used = 0 (0.0MB) ##survior2 区已使用情况 \n    free = 26804224 (25.5625MB) ##survior2 区剩余容量 \n    0.0% used ## survior2 区使用比例 \nPS Old Generation: ##老年代使用情况 \n    capacity = 1879048192 (1792.0MB) ##老年代容量 \n    used = 30847928 (29.41887664794922MB) ##老年代已使用容量 \n    free = 1848200264 (1762.5811233520508MB) ##老年代剩余容量 \n    1.6416783843721663% used ##老年代使用比例\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br")])]),s("h4",{attrs:{id:"histo-打印每个-class-的实例数目-内存占用-类全名信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#histo-打印每个-class-的实例数目-内存占用-类全名信息"}},[a._v("#")]),a._v(" -histo 打印每个 class 的实例数目,内存占用,类全名信息.")]),a._v(" "),s("p",[a._v("jmap –histo <pid>")]),a._v(" "),s("p",[a._v("jmap –histo:live <pid> 如果 live 子参数加上后,只统计活的对象数量.")]),a._v(" "),s("p",[a._v("但是这样显示太多了，一般在 linux 上会这么操作, Windows 不支持")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("jmap –histo:live "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1196")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("head")]),a._v(" -20 \n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("（这样只会显示排名前 20 的数据）")]),a._v(" "),s("h4",{attrs:{id:"不太重要的参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#不太重要的参数"}},[a._v("#")]),a._v(" 不太重要的参数")]),a._v(" "),s("p",[a._v("-finalizerinfo 打印正等候回收的对象的信息，还有 jmap –clstats 这个命令最好也不要去使用")]),a._v(" "),s("h4",{attrs:{id:"dump-生成的堆转储快照-比较重要"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dump-生成的堆转储快照-比较重要"}},[a._v("#")]),a._v(" -dump 生成的堆转储快照（比较重要）")]),a._v(" "),s("p",[a._v("jmap -dump:live,format=b,file=heap.bin <pid>")]),a._v(" "),s("p",[a._v("Sun JDK 提供 jhat（JVM Heap Analysis Tool）命令与 jmap 搭配使用，来分析 jmap 生成的堆转储快照。")]),a._v(" "),s("h3",{attrs:{id:"jhat-不推荐使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jhat-不推荐使用"}},[a._v("#")]),a._v(" jhat（不推荐使用）")]),a._v(" "),s("p",[a._v("jhat dump 文件名")]),a._v(" "),s("p",[a._v("后屏幕显示“Server is ready.”的提示后，用户在浏览器中键入 http://localhost:7000/就可以访问详情")]),a._v(" "),s("p",[a._v("使用 jhat 可以在服务器上生成堆转储文件分析（一般不推荐，毕竟占用服务器的资源，比如一个文件就有 1 个 G 的话就需要大约吃一个 1G 的内存资源）")]),a._v(" "),s("h3",{attrs:{id:"jstack"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jstack"}},[a._v("#")]),a._v(" jstack")]),a._v(" "),s("p",[a._v("（Stack Trace for Java）命令用于生成虚拟机当前时刻的线程快照。线程快照就是当前虚拟机内每一条线程正在执行的方法堆栈的集合，生成线程快照的主要目的是定位线程出现长时间停顿的原因，如线程间死锁、死循环、请求外部资源导致的长时间等待等都是导致线程长时间停顿的常见原因。 在代码中可以用 java.lang.Thread 类的 getAllStackTraces() 方法用于获取虚拟机中所有线程的 StackTraceElement 对象。使用这个方法可以通过简单的几行代码就完成 jstack 的大部分功能，在实际项目中不妨调用这个方法做个管理员页面，可以随时使用浏览器来查看线程堆栈。（并发编程中的线程安全课程中有具体的案例）")]),a._v(" "),s("p",[a._v("一般来说 jstack 主要是用来排查是否有死锁的情况，这块内容在并发编程（包括二期）中有详细的讲解。")]),a._v(" "),s("h2",{attrs:{id:"命令工具总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#命令工具总结"}},[a._v("#")]),a._v(" 命令工具总结")]),a._v(" "),s("h3",{attrs:{id:"生产服务器推荐开启"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生产服务器推荐开启"}},[a._v("#")]),a._v(" 生产服务器推荐开启")]),a._v(" "),s("ul",[s("li",[a._v("-XX:-HeapDumpOnOutOfMemoryError 默认关闭，建议开启，在 java.lang.OutOfMemoryError 异常出现时，输出一个 dump 文件，记录当时的堆内存快照。")]),a._v(" "),s("li",[a._v("-XX:HeapDumpPath=./java_pid<pid>.hprof 用来设置堆内存快照的存储文件路径，默认是 java 进程启动位置。")])]),a._v(" "),s("h3",{attrs:{id:"调优之前开启、调优之后关闭"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调优之前开启、调优之后关闭"}},[a._v("#")]),a._v(" 调优之前开启、调优之后关闭")]),a._v(" "),s("ul",[s("li",[a._v("-XX:+PrintGC 调试跟踪之打印简单的 GC 信息参数:")]),a._v(" "),s("li",[a._v("-XX:+PrintGCDetails, +XX:+PrintGCTimeStamps 打印详细的 GC 信息")]),a._v(" "),s("li",[a._v("-Xlogger:logpath 设置 gc 的日志路，如： -Xlogger:log/gc.log， 将 gc.log 的路径设置到当前目录的 log 目录下.")])]),a._v(" "),s("p",[a._v("应用场景：将 gc 的日志独立写入日志文件，将 GC 日志与系统业务日志进行了分离，方便开发人员进行追踪分析。")]),a._v(" "),s("h3",{attrs:{id:"考虑使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#考虑使用"}},[a._v("#")]),a._v(" 考虑使用")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("-XX:+PrintHeapAtGC， 打印堆信息")]),a._v(" "),s("ul",[s("li",[a._v("参数设置： -XX：+PrintHeapAtGC")]),a._v(" "),s("li",[a._v("应用场景： 获取 Heap 在每次垃圾回收前后的使用状况")])])]),a._v(" "),s("li",[s("p",[a._v("-XX:+TraceClassLoading")]),a._v(" "),s("ul",[s("li",[a._v("参数方法： -XX:+TraceClassLoading")]),a._v(" "),s("li",[a._v("应用场景： 在系统控制台信息中看到 class 加载的过程和具体的 class 信息，可用以分析类的加载顺序以及是否可进行精简操作。")])])]),a._v(" "),s("li",[s("p",[a._v("-XX:+DisableExplicitGC 禁止在运行期显式地调用 System.gc()")])])]),a._v(" "),s("h2",{attrs:{id:"可视化工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#可视化工具"}},[a._v("#")]),a._v(" 可视化工具")]),a._v(" "),s("p",[a._v("JMX（Java Management Extensions，即 Java 管理扩展）是一个为应用程序、设备、系统等植入管理功能的框架。JMX 可以跨越一系列异构操作系统平台、系统体系结构和网络传输协议，灵活的开发无缝集成的系统、网络和服务管理应用。")]),a._v(" "),s("p",[a._v("管理远程进程需要在远程程序的启动参数中增加：\n-Djava.rmi.server.hostname=......\n-Dcom.sun.management.jmxremote\n-Dcom.sun.management.jmxremote.port=8888\n-Dcom.sun.management.jmxremote.authenticate=false\n-Dcom.sun.management.jmxremote.ssl=false")]),a._v(" "),s("h3",{attrs:{id:"jconsole"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jconsole"}},[a._v("#")]),a._v(" JConsole")]),a._v(" "),s("p",[a._v("可以查看堆，内存，线程等信息。")]),a._v(" "),s("h3",{attrs:{id:"jvisualvm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvisualvm"}},[a._v("#")]),a._v(" JVisualvm")]),a._v(" "),s("p",[a._v("类似于JConsole, 但这个工具可以安装额外的插件。如：Visual GC 插件，可以查看新生代，老年代等内存变化。")]),a._v(" "),s("p",[a._v("插件中心地址: "),s("a",{attrs:{href:"https://visualvm.github.io",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://visualvm.github.io"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("但是注意版本问题，不同的 JDK 所带的 visualvm 是不一样的，下载插件时需要下对应的版本。 一般来说，这个工具是本机调试用，一般生产上来说，你一般是用不了的（除非启用远程连接）")]),a._v(" "),s("h2",{attrs:{id:"arthas-阿尔萨斯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#arthas-阿尔萨斯"}},[a._v("#")]),a._v(" Arthas（阿尔萨斯）")]),a._v(" "),s("p",[a._v("官方文档参考："),s("a",{attrs:{href:"https://alibaba.github.io/arthas/",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://alibaba.github.io/arthas/"),s("OutboundLink")],1),a._v(" Arthas 是 Alibaba 开源的 Java 诊断工具，深受开发者喜爱。")]),a._v(" "),s("p",[a._v("Arthas 支持 JDK 6+，支持 Linux/Mac/Windows，采用命令行交互模式，同时提供丰富的 Tab 自动补全功能，进一步方便进行问题的定位和诊断")]),a._v(" "),s("h3",{attrs:{id:"下载和安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载和安装"}},[a._v("#")]),a._v(" 下载和安装")]),a._v(" "),s("p",[a._v("下载文档："),s("a",{attrs:{href:"https://arthas.aliyun.com/doc/download.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://arthas.aliyun.com/doc/download.html"),s("OutboundLink")],1),a._v("\n下载地址："),s("a",{attrs:{href:"https://arthas.aliyun.com/download/latest_version?mirror=aliyun",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://arthas.aliyun.com/download/latest_version?mirror=aliyun"),s("OutboundLink")],1),a._v("\n不需要安装，就是一个 jar 包")]),a._v(" "),s("h3",{attrs:{id:"快速入门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快速入门"}},[a._v("#")]),a._v(" 快速入门")]),a._v(" "),s("p",[a._v("方法一：直接 java -jar arthas-boot.jar。选择 attach 的进程绑定")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启动 jar")]),a._v("\nC:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("mengweijin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Desktop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("arthas-packaging-3.5.0-bin"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("java -jar arthas-boot.jar\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" arthas-boot version: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3.5")]),a._v(".0\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" Found existing java process, please choose one and input the serial number of the process, eg "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(". Then hit ENTER.\n* "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(": "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("11728")]),a._v(" com.github.mengweijin.mybatisplus.demo.MybatisPlusDemoApplication\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(": "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("14608")]),a._v(" org.jetbrains.jps.cmdline.Launcher\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(": "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("13588")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 绑定Java 进程，这里输入数字：1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" arthas home: C:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("mengweijin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Desktop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("arthas-packaging-3.5.0-bin\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" Try to attach process "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("11728")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" Found java home from System Env JAVA_HOME: C:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Program Files"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("jdk1.8.0_251\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" Attach process "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("11728")]),a._v(" success.\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" arthas-client connect "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3658")]),a._v("\n  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.\n /  O  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("  .--. "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("''")]),a._v("--.  .--"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'|  '")]),a._v("--"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'  | /  O  \\ '")]),a._v("   .-"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'\n|  .-.  ||  '")]),a._v("--"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'.'")]),a._v("   "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("   "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("  .--.  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),a._v("  .-.  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("-.\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("    "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("   "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(".-"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'    |\n`--'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("--'"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("--"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("' '")]),a._v("--"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'   `--'")]),a._v("   "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("--'  "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("--"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'`--'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("--'"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("-----'\n\n\nwiki       https://arthas.aliyun.com/doc\ntutorials  https://arthas.aliyun.com/doc/arthas-tutorials.html\nversion    "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3.5")]),a._v(".0\nmain_class\npid        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("11728")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("time")]),a._v("       "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2021")]),a._v("-03-16 "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(":49:25\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 绑定成功，这里的命令行前缀已经变成了 arthas")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("arthas@11728"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br")])]),s("p",[a._v("方法二：通过 jps 命令快速查找 java 进程，再次直接绑定 java -jar arthas-boot.jar pid")]),a._v(" "),s("h3",{attrs:{id:"常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[a._v("#")]),a._v(" 常用命令")]),a._v(" "),s("h4",{attrs:{id:"dashboard"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dashboard"}},[a._v("#")]),a._v(" dashboard")]),a._v(" "),s("p",[a._v("注意在 arthas 中，有 tab 键填充功能，所以比较好用。但是这个界面是实时刷新的，一般 5s 刷新一次，使用 q 键退出刷新（没有退出 arthasq）")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 输入命令，即可打开 dashboard。5s 刷新一次")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("arthas@11728"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ dashboard\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h4",{attrs:{id:"thread"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#thread"}},[a._v("#")]),a._v(" thread")]),a._v(" "),s("p",[a._v("这个命令和 jstack 很相似，但是功能更加强大，主要是查看当前 JVM 的线程堆栈信息。同时可以结合使用 thread –b 来进行死锁的排查死锁。 参数解释：")]),a._v(" "),s("ul",[s("li",[a._v("-n 指定最忙的前 n 个线程并打印堆栈")]),a._v(" "),s("li",[a._v("-b 找出阻塞当前线程的线程")]),a._v(" "),s("li",[a._v("-i 指定 cpu 占比统计的采样间隔，单位为毫秒")])]),a._v(" "),s("p",[a._v("实战演示")]),a._v(" "),s("ul",[s("li",[a._v("thread –h 显示帮助")]),a._v(" "),s("li",[a._v("thread –b 找出阻塞当前线程的线程")]),a._v(" "),s("li",[a._v("thread -i 1000 -n 3 每过 1000 毫秒进行采样，显示最占 CPU 时间的前 3 个线程")]),a._v(" "),s("li",[a._v("thread --state WAITING 查看处于等待状态的线程")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("arthas@11728"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ thread -b\nNo "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("most")]),a._v(" blocking thread found"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("如果有死锁，会有红色的字提醒着，这个阻塞的线程已经被另外一个线程阻塞。")]),a._v(" "),s("h4",{attrs:{id:"jvm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm"}},[a._v("#")]),a._v(" jvm")]),a._v(" "),s("p",[a._v("显示 jvm 相关信息。")]),a._v(" "),s("h4",{attrs:{id:"jad"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jad"}},[a._v("#")]),a._v(" Jad")]),a._v(" "),s("p",[a._v("反编译指定已加载类的源码")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("arthas@11728"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ jad com.github.mengweijin.mybatisplus.demo.entity.User\n\nClassLoader:\n+-sun.misc.Launcher"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$AppClassLoader")]),a._v("@18b4aac2\n  +-sun.misc.Launcher"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$ExtClassLoader")]),a._v("@4b4523f8\n\nLocation:\n/C:/Source/code/gitee/quickboot/sample-quickboot-mybatis-plus/target/classes/\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 此处省略反编译后的文件内容。")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("h4",{attrs:{id:"trace"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#trace"}},[a._v("#")]),a._v(" trace")]),a._v(" "),s("p",[a._v("使用 trace 命令可以跟踪统计方法耗时。 继续跟踪耗时高的方法，然后再次访问")]),a._v(" "),s("p",[a._v("比如使用一个 Springboot 项目控制层 getUser 方法调用了 userService.get(uid);，这个方法中分别进行 check、service、redis、mysql 等操作操作。就可以根据这个命令跟踪出来哪里的耗时最长。")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("arthas@11728"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ trace com.github.mengweijin.mybatisplus.demo.controller.UserController getUser\nPress Q or Ctrl+C to abort.\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 然后在浏览器中请求接口，这里就可以接收到监控到的信息")]),a._v("\nAffect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("class count: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" , method count: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" cost "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("532")]),a._v(" ms, listenerId: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("---ts"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2021")]),a._v("-03-16 "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v(":35:35"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("thread_name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("http-nio-18080-exec-5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("21")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("is_daemon")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("priority")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("TCCL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@1322b575\n    "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("---"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("37")]),a._v(".9038ms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" com.github.mengweijin.mybatisplus.demo.controller.UserController"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$$")]),a._v("EnhancerBySpringCGLIB"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$$")]),a._v("d68ae9c2:getUser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("---"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("36")]),a._v(".6589ms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" org.springframework.cglib.proxy.MethodInterceptor:intercept"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#95")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("---"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(".222ms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" com.github.mengweijin.mybatisplus.demo.controller.UserController:getUser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                `---"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("18")]),a._v(".7934ms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" com.github.mengweijin.mybatisplus.demo.service.UserService:list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#40")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("h4",{attrs:{id:"monitor"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#monitor"}},[a._v("#")]),a._v(" monitor")]),a._v(" "),s("p",[a._v("每 10 秒统计一次 com.github.mengweijin.mybatisplus.demo.controller.UserController 类的  getUser 方法执行情况")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("arthas@11728"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ monitor -c "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(" com.github.mengweijin.mybatisplus.demo.controller.UserController getUser\nPress Q or Ctrl+C to abort.\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 然后在浏览器中请求接口，这里就可以接收到监控到的信息")]),a._v("\nAffect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("class count: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" , method count: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" cost "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("176")]),a._v(" ms, listenerId: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("\n timestamp         class                       method                     total    success   fail     avg-rt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  fail-rate\n-----------------------------------------------------------------------------------------------------------------------\n "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2021")]),a._v("-03-16 "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v(":45  com.github.mengweijin.myba  getUser                    "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9.10")]),a._v("     "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.00")]),a._v("%\n :22               tisplus.demo.controller.Us\n                   erController"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$$")]),a._v("EnhancerBySp\n                   ringCGLIB"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$$")]),a._v("d68ae9c2\n "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2021")]),a._v("-03-16 "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v(":45  com.github.mengweijin.myba  getUser                    "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.30")]),a._v("     "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.00")]),a._v("%\n :22               tisplus.demo.controller.Us\n                   erController\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])]),s("h4",{attrs:{id:"watch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#watch"}},[a._v("#")]),a._v(" watch")]),a._v(" "),s("p",[a._v("观察方法的入参出参信息。查看入参和出参")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("arthas@11728"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("watch")]),a._v(" com.github.mengweijin.mybatisplus.demo.controller.UserController getUserById "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{params[0],returnObj}'")]),a._v("\nPress Q or Ctrl+C to abort.\nAffect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("class count: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" , method count: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" cost "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("189")]),a._v(" ms, listenerId: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("method")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("com.github.mengweijin.mybatisplus.demo.controller.UserController.getUserById "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("location")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("AtExit\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ts")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2021")]),a._v("-03-16 "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v(":50:16"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("cost"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("33")]),a._v(".4166ms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("result")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("@ArrayList"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    @Long"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 入参")]),a._v("\n    null, "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 返回值")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h3",{attrs:{id:"命令汇总"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#命令汇总"}},[a._v("#")]),a._v(" 命令汇总")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[a._v("命令")]),a._v(" "),s("th",{staticStyle:{"text-align":"left"}},[a._v("介绍")])])]),a._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[a._v("dashboard")]),a._v(" "),s("td",{staticStyle:{"text-align":"left"}},[a._v("当前系统的实时数据面板")])]),a._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[a._v("thread")]),a._v(" "),s("td",{staticStyle:{"text-align":"left"}},[a._v("查看当前 JVM 的线程堆栈信息")])]),a._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[a._v("watch")]),a._v(" "),s("td",{staticStyle:{"text-align":"left"}},[a._v("方法执行数据观测")])]),a._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[a._v("trace")]),a._v(" "),s("td",{staticStyle:{"text-align":"left"}},[a._v("方法内部调用路径，并输出方法路径上的每个节点耗时")])]),a._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[a._v("stack")]),a._v(" "),s("td",{staticStyle:{"text-align":"left"}},[a._v("输出当前方法被调用的调用路径")])]),a._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[a._v("tt")]),a._v(" "),s("td",{staticStyle:{"text-align":"left"}},[a._v("方法执行数据的时空隧道，记录下指定方法每次调用的入参和返回信息，并能对这些不同的时间下调用进行观测")])]),a._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[a._v("monitor")]),a._v(" "),s("td",{staticStyle:{"text-align":"left"}},[a._v("方法执行监控")])]),a._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[a._v("jvm")]),a._v(" "),s("td",{staticStyle:{"text-align":"left"}},[a._v("查看当前 JVM 信息")])]),a._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[a._v("vmoption")]),a._v(" "),s("td",{staticStyle:{"text-align":"left"}},[a._v("查看，更新 JVM 诊断相关的参数")])]),a._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[a._v("sc")]),a._v(" "),s("td",{staticStyle:{"text-align":"left"}},[a._v("查看 JVM 已加载的类信息")])]),a._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[a._v("sm")]),a._v(" "),s("td",{staticStyle:{"text-align":"left"}},[a._v("查看已加载类的方法信息")])]),a._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[a._v("jad")]),a._v(" "),s("td",{staticStyle:{"text-align":"left"}},[a._v("反编译指定已加载类的源码")])]),a._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[a._v("classloader")]),a._v(" "),s("td",{staticStyle:{"text-align":"left"}},[a._v("查看 classloader 的继承树， urls，类加载信息")])]),a._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[a._v("heapdump")]),a._v(" "),s("td",{staticStyle:{"text-align":"left"}},[a._v("类似 jmap 命令的 heap dump 功能")])])])]),a._v(" "),s("h2",{attrs:{id:"动态追踪技术底层分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#动态追踪技术底层分析"}},[a._v("#")]),a._v(" 动态追踪技术底层分析")]),a._v(" "),s("p",[a._v("动态追踪技术是一个可以不用重启线上 java 项目来进行问题排查的技术，比如前面讲的 Arthas 就属于一种动态追踪的工具。它里面提供的 monitor 还有 watch 等命令就是动态的追踪技术。")]),a._v(" "),s("p",[a._v("当然我们学技术要知其然还要知其所以然，Arthas 工具的基础，就是 Java Agent 技术，可以利用它来构建一个附加的代理程序，用来协助检测性能，还可以替换一些现有功能，甚至 JDK 的一些类我们也能修改，有点像 JVM 级别的 AOP 功能。")]),a._v(" "),s("h3",{attrs:{id:"java-agent-技术"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java-agent-技术"}},[a._v("#")]),a._v(" Java Agent 技术")]),a._v(" "),s("p",[a._v("既然作为 JVM 的 AOP，就必须要有 AOP 的功能，所以 Java Agent 提供了两个类似于 AOP 的方法")]),a._v(" "),s("ul",[s("li",[a._v("一个方法叫做 premain 方法，可以在 main 运行之前的进行一些操作(Java 入口是一个 main 方法)")]),a._v(" "),s("li",[a._v("一个是 agentmain 方法，是控制类运行时的行为（Arthas 使用的就是这种） 但在一个 JVM 中，只会调用一个")])]),a._v(" "),s("p",[a._v("要构建一个 agent 程序，大体可分为以下步骤：")]),a._v(" "),s("ul",[s("li",[a._v("使用字节码增强工具，编写增强代码；")]),a._v(" "),s("li",[a._v("在 manifest 中指定 Premain-Class/Agent-Class 属性；")]),a._v(" "),s("li",[a._v("使用参数加载或者使用 attach 方式改变 app 项目中的内容；")])]),a._v(" "),s("h4",{attrs:{id:"agentmain"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#agentmain"}},[a._v("#")]),a._v(" Agentmain")]),a._v(" "),s("p",[a._v("这种模式一般用在一些诊断工具上。使用 jdk/lib/tools.jar 中的工具类中的 Attach API，可以动态的为运行中的程序加入一些功能。它的主要运行步骤如下：")]),a._v(" "),s("ul",[s("li",[a._v("获取机器上运行的所有 JVM 进程 ID；")]),a._v(" "),s("li",[a._v("选择要诊断的 jvm；")]),a._v(" "),s("li",[a._v("将 jvm 使用 attach 函数链接上；")]),a._v(" "),s("li",[a._v("使用 loadAgent 函数加载 agent，动态修改字节码；")]),a._v(" "),s("li",[a._v("卸载 jvm。")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("throws")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("IOException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AttachNotSupportedException")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("VirtualMachineDescriptor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" list "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("VirtualMachine")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("VirtualMachineDescriptor")]),a._v(" vmd"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("vmd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("displayName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("endsWith")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"MainRun"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("VirtualMachine")]),a._v(" virtualMachine "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("VirtualMachine")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("attach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("vmd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" version "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" virtualMachine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getSystemProperties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"java.version"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// virtualMachine.loadAgent("xxx.jar", "...");')]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Version: "')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" version"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            virtualMachine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("detach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br")])]),s("h4",{attrs:{id:"java-attach-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java-attach-api"}},[a._v("#")]),a._v(" Java Attach API")]),a._v(" "),s("p",[a._v("Attach API 不是 Java 的标准 API，而是 Sun 公司提供的一套扩展 API，用来向目标 JVM ”附着”（Attach）代理工具程序的。有了它， 开发者可以方便的监控一个 JVM，运行一个外加的代理程序。Attach API 只有 2 个主要的类，都在 com.sun.tools.attach 包(在 jdk 的 lib 目录下 tools.jar 里面)里面：")]),a._v(" "),s("p",[a._v("VirtualMachine 代表一个 Java 虚拟机，也就是程序需要监控的目标虚拟机，提供了 JVM 枚举，Attach 动作和 Detach 动作（Attach 动 作的相反行为，从 JVM 上面解除一个代理）等等;")]),a._v(" "),s("p",[a._v("VirtualMachineDescriptor 则是一个描述虚拟机的容器类，配合 VirtualMachine 类完成各种功能。")]),a._v(" "),s("p",[a._v("Java Attach API 是一个 API 接口，JDK 提供的，它可以将应用程序连接到另一个目标虚拟机。然后，您的应用程序可以将代理应用程序装入目标虚拟机，例如，用于执行监视状态之类的任务。 JVM Attach API 功能上非常简单，主要功能如下:")]),a._v(" "),s("ul",[s("li",[a._v("Attach 到其中一个 JVM 上，建立通信管道")]),a._v(" "),s("li",[a._v("让目标 JVM 加载 Agent")])]),a._v(" "),s("p",[a._v("使用入门： 不过我在 IDE 使用它的时候，要注意到，这个 API 属于 JDK 的包，所以使用它项目中必须要引用它。 首先项目中引用到 tools.jar(这个包在 JDK 的安装目录的 lib 下面)")]),a._v(" "),s("ol",[s("li",[a._v("JVM 进程号，通过 jps 命令获取")]),a._v(" "),s("li",[a._v("使用 VirtualMachine.attach()向目标 JVM ”附着”")]),a._v(" "),s("li",[a._v("利用 VirtualMachine 和 VirtualMachineDescriptor 就可以获取 VM 相关的信息。")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("throws")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("IOException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AttachNotSupportedException")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// VM进程号，通过 jps 命令获取")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// attach 向目标 JVM 附着（Attach）代理工具程序")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("VirtualMachine")]),a._v(" virtualMachine "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("VirtualMachine")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("attach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"12345"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// get system properties in target VM")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" version "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" virtualMachine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getSystemProperties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"java.version"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Version: "')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" version"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// VirtualMachineDescriptor 是一个描述虚拟机的容器类，配合 VirtualMachine 类完成各种功能")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("VirtualMachineDescriptor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" list "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("VirtualMachine")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 从 JVM 上面解除代理")]),a._v("\n    virtualMachine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("detach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{442:function(s,a,n){"use strict";n.r(a);var e=n(28),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("Jenkins 官方镜像："),n("a",{attrs:{href:"https://hub.docker.com/r/jenkins/jenkins",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://hub.docker.com/r/jenkins/jenkins"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("Github Document: "),n("a",{attrs:{href:"https://github.com/jenkinsci/docker/blob/master/README.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/jenkinsci/docker/blob/master/README.md"),n("OutboundLink")],1)]),s._v(" "),n("h3",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("docker run -d --name jenkins -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v(":50000 --restart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always jenkins/jenkins:lts-jdk17\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载卷")]),s._v("\ndocker run -d --name jenkins -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v(":50000 --restart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always -v jenkins_home:/var/jenkins_home jenkins/jenkins:lts-jdk17\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("访问：http://localhost:8080")]),s._v(" "),n("p",[s._v("然后等待 jenkins 初始化，这个过程需要很长时间。jenkins 初始化完成后，浏览器自动进入 Jenkins 页面。")]),s._v(" "),n("p",[s._v("这个过程可能遇到问题：浏览器界面一直显示 Please wait while Jenkins is getting ready to work …")]),s._v(" "),n("p",[s._v("方案一：重启容器试试，有时候网络就好了，建议先多尝试几次。")]),s._v(" "),n("p",[s._v("方案二：如果方案一重试了好几次都不行，可能是网络被墙的太彻底的原因，尝试以下改动：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it jenkins /bin/bash\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 找到一个名为：hudson.model.UpdateCenter.xml 的文件")]),s._v("\nll\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改内容")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 https://updates.jenkins.io/update-center.json ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更改为：https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" hudson.model.UpdateCenter.xml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存，退出")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 退出容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启 jenkins")]),s._v("\ndocker restart jenkins\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h3",{attrs:{id:"解锁-jenkins"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解锁-jenkins"}},[s._v("#")]),s._v(" 解锁 Jenkins")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在启动日志中查看第一次登录时的密码")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# You can access logs with command 'docker logs CONTAINER_ID' in order to check first login token.")]),s._v("\ndocker logs jenkins\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker logs -f jenkins")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者进入容器中查看")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it jenkins /bin/bash\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /var/jenkins_home/secrets/initialAdminPassword\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("然后输入初始密码，进入新手入门配置。")]),s._v(" "),n("h3",{attrs:{id:"新手入门"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#新手入门"}},[s._v("#")]),s._v(" 新手入门")]),s._v(" "),n("p",[s._v("点击："),n("strong",[s._v("安装推荐的插件")]),s._v("（如果自己选插件的话容易遗漏一些依赖项）")]),s._v(" "),n("p",[s._v("然后下一步，进入漫长的安装过程中，等待安装完成，如果有失败项，页面可以进行安装重试。")]),s._v(" "),n("p",[s._v("进入：【"),n("strong",[s._v("创建第一个管理员用户")]),s._v("】这个可以直接【"),n("strong",[s._v("使用admin账户继续")]),s._v("】")]),s._v(" "),n("p",[s._v("进入：【"),n("strong",[s._v("实例配置")]),s._v("】默认 url 不用修改，【"),n("strong",[s._v("保存并完成")]),s._v("】")]),s._v(" "),n("p",[s._v("初始安装到这里就完成了。")]),s._v(" "),n("h3",{attrs:{id:"插件安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#插件安装"}},[s._v("#")]),s._v(" 插件安装")]),s._v(" "),n("p",[s._v("进入【系统管理】-【插件管理】检查如下插件是否安装，没安装的安装一下。")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("Git plugin")]),s._v(" ：拉取代码时需要")]),s._v(" "),n("li",[n("strong",[s._v("Maven Integration plugin")]),s._v(" ：编译 jar 时需要")]),s._v(" "),n("li",[n("strong",[s._v("NodeJS Plugin")]),s._v(" ：编译前端工程时需要")]),s._v(" "),n("li",[n("strong",[s._v("Publish Over SSH")]),s._v(" ：发送文件以及远程执行脚本、命令时需要")])]),s._v(" "),n("h3",{attrs:{id:"全局工具配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#全局工具配置"}},[s._v("#")]),s._v(" 全局工具配置")]),s._v(" "),n("p",[s._v("进入【系统管理】-【全局工具配置】")]),s._v(" "),n("h4",{attrs:{id:"jdk-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jdk-安装"}},[s._v("#")]),s._v(" JDK 安装")]),s._v(" "),n("p",[s._v("镜像 jenkins/jenkins:lts-jdk17 中默认使用的 jdk 17，如果刚好符合你的要求，那么下面可以略过。")]),s._v(" "),n("p",[s._v("但你可能想用其他版本，比如 jdk 8，这时就需要额外安装 jdk 了，但是 OpenJDK 8 在 Debian 11 不再提供支持了，只能手动安装。")]),s._v(" "),n("p",[s._v("安装过程略（可参考其他博客安装），假定已经安装到 /opt/java8/bin 目录下了，配置如下信息。")]),s._v(" "),n("p",[s._v("配置如下信息：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 别名")]),s._v("\nJDK8\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# JAVA_HOME")]),s._v("\n/opt/java/jdk1.8.0_202\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("至此，jenkins 构建时，便会使用这里配置的 JDK。")]),s._v(" "),n("h4",{attrs:{id:"git-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#git-安装"}},[s._v("#")]),s._v(" git 安装")]),s._v(" "),n("p",[n("strong",[s._v("安装推荐的插件")]),s._v("中已经包含了 git，因此无需额外安装，使用默认配置信息即可。")]),s._v(" "),n("p",[s._v("配置如下信息：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# NAME")]),s._v("\nDefault\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Path to Git executable")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("注：git 也可以手动安装，手动安装只需要配置 git 程序的位置。")]),s._v(" "),n("p",[s._v("注：上面代码段里的 "),n("strong",[s._v("git")]),s._v(" 相当于 Windows 下的 git.exe，在容器中已经加到了环境变量，可以直接使用 git 命令。")]),s._v(" "),n("h4",{attrs:{id:"maven-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#maven-安装"}},[s._v("#")]),s._v(" maven 安装")]),s._v(" "),n("p",[s._v("配置如下信息：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# NAME")]),s._v("\nmaven\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MAVEN_HOME")]),s._v("\n/opt/maven/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("然后勾选【"),n("strong",[s._v("自动安装")]),s._v("】复选框，选择"),n("strong",[s._v("从 Apache 安装")]),s._v("，再选择一个版本即可，容器中就会自动安装到配置的 /opt/maven/ 目录下。")]),s._v(" "),n("p",[s._v("注：maven 也可以手动安装，手动安装就不需要勾选"),n("strong",[s._v("自动安装")]),s._v("复选框了，只需要配置 MAVEN_HOME 的位置。")]),s._v(" "),n("h4",{attrs:{id:"nodejs-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nodejs-安装"}},[s._v("#")]),s._v(" NodeJS 安装")]),s._v(" "),n("p",[s._v("配置如下信息：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 别名")]),s._v("\nnodejs\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装目录")]),s._v("\n/opt/nodejs\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("然后勾选【"),n("strong",[s._v("自动安装")]),s._v("】复选框，选择"),n("strong",[s._v("Install from nodejs.org")]),s._v("，再选择一个版本即可，容器中就会自动安装到配置的 /opt/nodejs 目录下。")]),s._v(" "),n("p",[s._v("注：nodejs 也可以手动安装，手动安装就不需要勾选"),n("strong",[s._v("自动安装")]),s._v("复选框了，只需要配置"),n("strong",[s._v("安装目录")]),s._v("的位置。")]),s._v(" "),n("h3",{attrs:{id:"系统配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#系统配置"}},[s._v("#")]),s._v(" 系统配置")]),s._v(" "),n("p",[s._v("进入【系统管理】-【系统配置】")]),s._v(" "),n("p",[s._v("向下拉滚动条，找打【Publish over SSH】下的【SSH Servers】，点击【新增】按钮，新增一个或多个 SSH Server(根据需要)")]),s._v(" "),n("p",[s._v("SSH Server 配置示例如下：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Name")]),s._v("\nVitality: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.100:22\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Hostname")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.100\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Username")]),s._v("\nroot\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Remote Directory")]),s._v("\n/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 点击【高级】按钮，展开后，填写端口等信息")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Port")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Timeout (ms)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("300000")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("然后保存即可，这样一个 SSH Server 就配置完成了，后面就可以直接引用。")]),s._v(" "),n("p",[s._v("其中，Remote Directory 值表示连接服务器后，进入的服务器根目录，建议配置为：/")]),s._v(" "),n("h3",{attrs:{id:"凭据管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#凭据管理"}},[s._v("#")]),s._v(" 凭据管理")]),s._v(" "),n("p",[s._v("一般 git 拉取代码都需要用户名和密码，除非是开源的，这时候就需要添加凭据。")]),s._v(" "),n("p",[s._v("以配置 git 凭据为例，进入 【系统管理】-【凭据】，鼠标移动并点击表格列【域】下面的【全局】字样，进入全局凭据管理。")]),s._v(" "),n("p",[s._v("然后点击右上角【+ Add Credentials】，然后选择【Username with password】，输入 git 的用户名，密码（ID不用填写），保存即可。")]),s._v(" "),n("p",[s._v("下面就到正题了")]),s._v(" "),n("h3",{attrs:{id:"maven-构建和部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#maven-构建和部署"}},[s._v("#")]),s._v(" Maven 构建和部署")]),s._v(" "),n("p",[s._v("进入 Dashboard 首页，创建【构建一个maven项目】，输入名称，点确定后，进入配置。")]),s._v(" "),n("h4",{attrs:{id:"源码管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#源码管理"}},[s._v("#")]),s._v(" 源码管理")]),s._v(" "),n("p",[s._v("选择【Git】单选框，输入代码仓库信息：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Repository URL")]),s._v("\nhttps://gitee.com/mengweijin/vitality.git\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Credentials")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Credentials 下拉框会自动带出【凭据】中提前配置的信息，直接选择即可。如果没有提前配置，这里也可以新增凭据。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定分支（为空时代表any)")]),s._v("\n*/master\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h4",{attrs:{id:"构建环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建环境"}},[s._v("#")]),s._v(" 构建环境")]),s._v(" "),n("p",[s._v("勾选"),n("strong",[s._v("在构建日志中添加时间戳前缀")]),s._v("的复选框")]),s._v(" "),n("h4",{attrs:{id:"build"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#build"}},[s._v("#")]),s._v(" Build")]),s._v(" "),n("p",[s._v("maven 的执行命令，可以加需要的构建参数。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Root POM")]),s._v("\npom.xml\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Goals and options")]),s._v("\nclean package -Dmaven.test.skip"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true -Psit\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"post-steps"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#post-steps"}},[s._v("#")]),s._v(" Post Steps")]),s._v(" "),n("p",[s._v("maven 打包后的后处理操作。勾选【"),n("strong",[s._v("Run only if build succeeds")]),s._v("】单选框，只有打包成功才执行后处理操作。")]),s._v(" "),n("p",[s._v("点击【Add post-build step】按钮，可以选择【Send files or execute commands over SSH】选项，发送打包好的 jar 到目标主机并执行命令启动程序。")]),s._v(" "),n("p",[s._v("SSH Publishers")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SSH Server 从前面【系统配置】中配置的服务器选择")]),s._v("\nVitality: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.100:22\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后点击【高级】，由于服务器连接可能失败，所以建议多 Retry 几次，配置参数：每个10秒重试一次，共重试10次")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Retry")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Delay")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("Transfer Set")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Transfer Set")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Source files")]),s._v("\nvitality-admin/target/vitality-admin.jar\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Remove prefix")]),s._v("\nvitality-admin/target/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Remote directory（这里就用到【系统配置】时配置的服务器 Remote Directory 的参数值）")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意开头没有 /，/ 已经在服务器  Remote Directory 中配置了")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接发送文件到服务器启动位置：/opt/vitality/vitality-admin.jar")]),s._v("\nopt/vitality\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Exec command（这个文本域框初始有点小，可以用鼠标拖动变大的）")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("Exec command（这个文本域框初始有点小，可以用鼠标拖动变大的）")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# jar 包已经通过 jenkins 流水线放到指定位置了，只需要重启服务和监控")]),s._v("\nsystemctl restart vitality \n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f /opt/vitality/logs/debug.log -n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/启动成功|启动失败/ q'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("至此，maven 打包并部署的配置就完成了，后续运行 pipeline 构建即可。")]),s._v(" "),n("h3",{attrs:{id:"vue-构建和部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vue-构建和部署"}},[s._v("#")]),s._v(" Vue 构建和部署")]),s._v(" "),n("p",[s._v("进入 Dashboard 首页，创建【构建一个自由风格的软件项目】，输入名称，点确定后，进入配置。")]),s._v(" "),n("h4",{attrs:{id:"源码管理-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#源码管理-2"}},[s._v("#")]),s._v(" 源码管理")]),s._v(" "),n("p",[s._v("选择【Git】单选框，输入代码仓库信息：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Repository URL")]),s._v("\nhttps://gitee.com/mengweijin/vitality.git\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Credentials")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Credentials 下拉框会自动带出【凭据】中提前配置的信息，直接选择即可。如果没有提前配置，这里也可以新增凭据。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定分支（为空时代表any)")]),s._v("\n*/master\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("注：假如 vue 前端工程在仓库根目录下的：vitality-ui 目录下")]),s._v(" "),n("h4",{attrs:{id:"构建环境-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建环境-2"}},[s._v("#")]),s._v(" 构建环境")]),s._v(" "),n("p",[s._v("勾选"),n("strong",[s._v("在构建日志中添加时间戳前缀")]),s._v("的复选框")]),s._v(" "),n("h4",{attrs:{id:"build-steps"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#build-steps"}},[s._v("#")]),s._v(" Build Steps")]),s._v(" "),n("p",[s._v("点击【增加构建步骤】按钮，选择【执行 shell】，输入：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORKSPACE")]),s._v("/vitality-ui\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_OPTIONS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("--openssl-legacy-provider\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build:prod\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"send-files-or-execute-commands-over-ssh"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#send-files-or-execute-commands-over-ssh"}},[s._v("#")]),s._v(" Send files or execute commands over SSH")]),s._v(" "),n("p",[s._v("点击【增加构建步骤】按钮，选择【Send files or execute commands over SSH】，输入：")]),s._v(" "),n("p",[s._v("SSH Publishers")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SSH Server 从前面【系统配置】中配置的服务器选择")]),s._v("\nVitality: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.100:22\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后点击【高级】，由于服务器连接可能失败，所以建议多 Retry 几次，配置参数：每个10秒重试一次，共重试10次")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Retry")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Delay")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("Transfer Set")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Transfer Set")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Source files")]),s._v("\nvitality-ui/dist/**/*\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Remove prefix")]),s._v("\nvitality-ui/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Remote directory（这里就用到【系统配置】时配置的服务器 Remote Directory 的参数值）")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意开头没有 /，/ 已经在服务器  Remote Directory 中配置了")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发送文件到服务器备份目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注：为什么上面的 jar 可以不用备份？")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       因为 jar 可以直接从流水线构建历史中下载下来，流水线本身就有历史备份，")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       只是 npm 管理的工程没法在页面直接下载部署的文件出来，才需要曲线备份。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       当然也可以不备份，有需要了直接 SSH 连接去流水线工作目录去找，然后手动下载。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $BUILD_NUMBER 是引用的 jenkins 内置变量，是一个构建流水号")]),s._v("\nopt/vitality/build_vue_"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BUILD_NUMBER")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Exec command（这个文本域框初始有点小，可以用鼠标拖动变大的）")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("Exec command（这个文本域框初始有点小，可以用鼠标拖动变大的）")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r /opt/vitality/build_vue_"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BUILD_NUMBER")]),s._v("/dist/* /usr/share/nginx/html/\nsystemctl restart nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("至此，vue 前端打包并部署的配置就完成了，后续运行 pipeline 构建即可。")])])}),[],!1,null,null,null);a.default=t.exports}}]);
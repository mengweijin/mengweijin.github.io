(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{469:function(s,e,t){"use strict";t.r(e);var a=t(28),n=Object(a.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"jks-和-keystore-密钥库文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jks-和-keystore-密钥库文件"}},[s._v("#")]),s._v(" .jks 和 .keystore 密钥库文件")]),s._v(" "),t("p",[s._v("jks 和 keystore 都是密钥库，可以用来存储证书和私钥。在 java 中一般使用 jks 密钥库，二者功能一样，可以互相转换。")]),s._v(" "),t("h2",{attrs:{id:"crt-和-cer-证书文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#crt-和-cer-证书文件"}},[s._v("#")]),s._v(" .crt 和 .cer 证书文件")]),s._v(" "),t("ul",[t("li",[s._v(".crt：扩展名CRT用于证书。证书可以是DER编码，也可以是PEM编码。扩展名CER和CRT几乎是同义词。这种情况在各种unix/linux系统中很常见。")]),s._v(" "),t("li",[s._v(".cer：CRT证书的微软型式。可以用微软的工具把CRT文件转换为CER文件（CRT和CER必须是相同编码的，DER或者PEM）。扩展名为CER的文件可以被IE识别并作为命令调用微软的cryptoAPI（具体点就是rudll32.exe")])]),s._v(" "),t("h2",{attrs:{id:"keytool-help"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#keytool-help"}},[s._v("#")]),s._v(" keytool -help")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('PS C:\\Source> keytool -help\n密钥和证书管理工具\n命令:\n -certreq            生成证书请求\n -changealias        更改条目的别名\n -delete             删除条目\n -exportcert         导出证书\n -genkeypair         生成密钥对\n -genseckey          生成密钥\n -gencert            根据证书请求生成证书\n -importcert         导入证书或证书链\n -importpass         导入口令\n -importkeystore     从其他密钥库导入一个或所有条目\n -keypasswd          更改条目的密钥口令\n -list               列出密钥库中的条目\n -printcert          打印证书内容\n -printcertreq       打印证书请求的内容\n -printcrl           打印 CRL 文件的内容\n -storepasswd        更改密钥库的存储口令\n\n使用 "keytool -command_name -help" 获取 command_name 的用法\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("h3",{attrs:{id:"keytool-genkeypair-help"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#keytool-genkeypair-help"}},[s._v("#")]),s._v(" keytool -genkeypair -help")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('PS C:\\Source> keytool -genkeypair -help\nkeytool -genkeypair [OPTION]...\n生成密钥对\n选项:\n -alias <alias>                  要处理的条目的别名\n -keyalg <keyalg>                密钥算法名称（当使用 -genkeypair 参数时可选为 RSA 或 DSA）\n -keysize <keysize>              密钥位大小\n -sigalg <sigalg>                签名算法名称\n -destalias <destalias>          目标别名\n -dname <dname>                  唯一判别名（CN：名字与姓氏（域名）； OU：组织单位名称； O：组织名称； L：城市或区域名称； ST：省/市/自治区名称； C：该单位的双字母国家/地区代码）\n -startdate <startdate>          证书有效期开始日期/时间\n -ext <value>                    X.509 扩展\n -validity <valDays>             有效天数（默认大约90天）\n -keypass <arg>                  密钥口令\n -keystore <keystore>            密钥库名称\n -storepass <arg>                密钥库口令\n -storetype <storetype>          密钥库类型（常用的有JKS（默认），JCEKS，PKCS12（行业标准推荐），BKS，UBER 等。\n                                 KeyStore 的类型并不要求在文件名上体现，但是使用者要明确所使用的KeyStore的格式）\n -providername <providername>    提供方名称\n -providerclass <providerclass>  提供方类名\n -providerarg <arg>              提供方参数\n -providerpath <pathlist>        提供方类路径\n -v                              详细输出\n -protected                      通过受保护的机制的口令\n使用 "keytool -help" 获取所有可用命令\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("h2",{attrs:{id:"keystore-和-truststore"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#keystore-和-truststore"}},[s._v("#")]),s._v(" KeyStore 和 TrustStore")]),s._v(" "),t("ul",[t("li",[s._v("KeyStore 是服务器的密钥存储库，存服务器的公钥私钥证书")]),s._v(" "),t("li",[s._v("TrustStore 是服务器的信任密钥存储库，存CA公钥，但有一部分人存的是客户端证书集合，这样并不合适")])]),s._v(" "),t("p",[s._v("错误的使用：把 KeyStore 和 TrustStore 做成同一个 JKS 文件或 PKCS12 文件。通过导入客户端证书来实现验证客户端证书。实际生产中并不能这么做，客户端有成千上万个，你不可能都去导吧。")]),s._v(" "),t("p",[s._v("因为 KeyStore 和 TrustStore Java 中都可以通过 keytool 来管理的，所以在使用时多有混淆。记住以下几点，可以最大限度避免这些混淆:")]),s._v(" "),t("ul",[t("li",[s._v("如果要保存你自己的密码，秘钥和证书，应该使用KeyStore，并且该文件要保持私密不外泄，不要传播该文件;")]),s._v(" "),t("li",[s._v("如果要保存你信任的来自他人的公钥和证书，应该使用 TrustStore，而不是 KeyStore;")]),s._v(" "),t("li",[s._v("在以上两种情况中的文件命名，要尽量提示其安全敏感程度而不是有歧义或者误导")]),s._v(" "),t("li",[s._v("比如使用 KeyStore 的场景把文件命名为 truststore.jks, 或者该使用 TrustStore 的情况下把文件命名为 keystore.jks 之类，这些用法都属于严重误导随后的使用者，有可能把比较私密的文件泄露出去；")]),s._v(" "),t("li",[s._v("拿到任何一个这样的文件时，确认清楚其内容然后决定怎样使用；")]),s._v(" "),t("li",[s._v("因为 KeyStore 文件既可以存储敏感信息，比如密码和私钥，也可以存储公开信息比如公钥，证书之类，所有实际上来讲，可以将 KeyStore 文件同样用做 TrustStore 文件, 但这样做要确保使用者很明确自己永远不会将该 KeyStore 误当作 TrustStore 传播出去。")])]),s._v(" "),t("p",[s._v("一个 TrustStore 仅仅用来包含客户端信任的证书，所以，这是一个客户端 “所信任的来自其他人或者组织的信息” 的存储文件，而不能用于存储任何安全敏感信息，比如私钥(private key)或者密码。")]),s._v(" "),t("p",[s._v("客户端通常会包含一些大的CA机构的证书，这样当遇到新的证书时，客户端就可以使用这些CA机构的证书来验证这些新来的证书是否是合法的。")]),s._v(" "),t("h2",{attrs:{id:"生成-keystore-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成-keystore-文件"}},[s._v("#")]),s._v(" 生成 Keystore 文件")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不能单纯的生成一个密钥库，生成密钥库的时候必须同时生成一个条目。下面这个命令在当前工作目录生成了一个密钥库文件 keystore.jks，里面存储了一个别名为 mengweijin 的密钥对")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成服务端密钥 jks 文件。注意：-storetype jks 参数，如果配置为 JKS，则在 SpringBoot 中也需要配置为对应的类型：key-store-type: JKS")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在cmd中执行JDK中keytool的命令，创建一个文件名为 keystore.jks，别名为 mengweijin 的密钥库：")]),s._v("\nkeytool -genkeypair -alias mengweijin -validity "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("36500")]),s._v(" -keyalg RSA -dname "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN=mengweijin.com,OU=com.mengweijin,O=mengweijin,L=xi an,ST=shan xi, C=CN"')]),s._v(" -keypass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" -storepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" -storetype JKS -keystore keystore.jks\n\nWarning:\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 由于我们是在 SpringBoot 中配置 JKS 格式的密钥库，因此，不必按照下面的告警信息迁移到 PKCS12（.p12） 格式。如果需要迁移到 p12 格式，按照提示执行命令即可。")]),s._v("\nJKS 密钥库使用专用格式。建议使用 "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"keytool -importkeystore -srckeystore keystore.jks -destkeystore keystore.jks -deststoretype pkcs12"')]),s._v(" 迁移到行业标准格式 PKCS12。\nPS C:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Source"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 到这里已经在命令行执行目录下生成了 keystore.jks 密钥库文件。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h2",{attrs:{id:"使用openssl查看公钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用openssl查看公钥"}},[s._v("#")]),s._v(" 使用openssl查看公钥")]),s._v(" "),t("h3",{attrs:{id:"安装openssl-如果电脑上已经安装过了-就可以跳过"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装openssl-如果电脑上已经安装过了-就可以跳过"}},[s._v("#")]),s._v(" 安装openssl（如果电脑上已经安装过了，就可以跳过）")]),s._v(" "),t("p",[s._v("URL: http://slproweb.com/products/Win32OpenSSL.html")]),s._v(" "),t("p",[s._v("安装完成后，配置环境变量。把openssl安装路径bin的路径（例如 C:\\Program Files\\OpenSSL-Win64\\bin）加入到操作系统的系统环境变量Path中。")]),s._v(" "),t("p",[s._v("关闭当前cmd窗口，或者重启电脑，重新打开一个cmd，此时openssl命令就可以直接使用了。")]),s._v(" "),t("h3",{attrs:{id:"查看公钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看公钥"}},[s._v("#")]),s._v(" 查看公钥")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行查看公钥的命令：")]),s._v("\nkeytool -list -rfc --keystore keystore.jks -storepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" openssl x509 -inform pem -pubkey\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成的公钥（-----BEGIN PUBLIC KEY----- 和 -----END PUBLIC KEY----- 之间的是公钥，包括这两个头和尾）")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"keytool-v-importkeystore-密钥库格式类型转换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#keytool-v-importkeystore-密钥库格式类型转换"}},[s._v("#")]),s._v(" keytool -v -importkeystore 密钥库格式类型转换")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# .jks 转 .p12 格式")]),s._v("\nkeytool -v -importkeystore -srcstoretype JKS -srckeystore keystore.jks -srcstorepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" -srcalias mengweijin -srckeypass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" -deststoretype PKCS12 -destkeystore keystore.p12 -deststorepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" -destalias mengweijin -destkeypass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# .jks 转 .keystore 同理，只是这个参数依然是这样：-deststoretype JKS")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 另外，所有 .keystore 与 .p12 之间的转换跟 .jks 与 .p12 之间的转换参数完全一样。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"p12-导出私钥文件-key"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#p12-导出私钥文件-key"}},[s._v("#")]),s._v(" .p12 导出私钥文件（ .key）")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# .key 文件不能通过 keytool 导出，只能通过代码或者 openssl 等工具导出。")]),s._v("\nopenssl pkcs12 -in keystore.p12 -nocerts -nodes -out mengweijin.key -password pass:123456\n\nPS C:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Source"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" openssl pkcs12 -help\nUsage: pkcs12 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nValid options are:\n -nokeys             Don"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'t output private keys\n -nodes              Don'")]),s._v("t encrypt private keys\n -in infile          Input filename\n -out outfile        Output filename\n -password val       Set import/export password "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" 这里省略了其他命令帮助信息\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h3",{attrs:{id:"jks-导出证书文件-cer-或者-crt"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jks-导出证书文件-cer-或者-crt"}},[s._v("#")]),s._v(" .jks 导出证书文件（ .cer 或者 .crt ）")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导出 .crt")]),s._v("\nkeytool -v -export -alias mengweijin -keystore keystore.jks -storepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" -rfc -file mengweijin.crt\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导出 .cer")]),s._v("\nkeytool -v -export -alias mengweijin -keystore keystore.jks -storepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" -rfc -file mengweijin.cer\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意：.keystore 同理。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{376:function(s,a,e){s.exports=e.p+"assets/img/master-slaves.0ea17ba5.png"},377:function(s,a,e){s.exports=e.p+"assets/img/dual-master.507da763.png"},378:function(s,a,e){s.exports=e.p+"assets/img/master-slaves-slaves.0b792de1.png"},379:function(s,a,e){s.exports=e.p+"assets/img/dual-master-slaves.f5afe384.png"},380:function(s,a,e){s.exports=e.p+"assets/img/Replication-Implementation-Rationale.df10b7d8.png"},381:function(s,a,e){s.exports=e.p+"assets/img/HAProxy.92ffc78a.png"},440:function(s,a,e){"use strict";e.r(a);var n=e(28),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"数据库扩展解决了什么问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据库扩展解决了什么问题"}},[s._v("#")]),s._v(" 数据库扩展解决了什么问题？")]),s._v(" "),n("ul",[n("li",[s._v("热备份，多活，故障切换")]),s._v(" "),n("li",[s._v("负载均衡、读写分离")])]),s._v(" "),n("h2",{attrs:{id:"replication-主从复制-常用架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#replication-主从复制-常用架构"}},[s._v("#")]),s._v(" Replication（主从复制）常用架构")]),s._v(" "),n("h3",{attrs:{id:"常规复制架构-master-slaves"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常规复制架构-master-slaves"}},[s._v("#")]),s._v(" 常规复制架构(Master --- Slaves)")]),s._v(" "),n("p",[s._v("在实际应用场景中，MySQL 复制 90% 以上都是一个 Master 复制到一个或者多个 Slave 的架构模式")]),s._v(" "),n("p",[n("img",{attrs:{src:e(376),alt:"image"}})]),s._v(" "),n("p",[s._v("缺点：")]),s._v(" "),n("ol",[n("li",[s._v("master不能停机，停机就不能接收写请求")]),s._v(" "),n("li",[s._v("slave过多会出现延迟。由于 master 需要进行常规维护停机了，那么必须要把一个 slave 提成master，选哪一个是一个问题。")])]),s._v(" "),n("p",[s._v("某一个 slave 提成 master 了，就存在当前 master 和之前的 master 数据不一致的情况，并且之前master 并没有保存当前 master 节点的 binlog 文件和 pos 位置。")]),s._v(" "),n("h3",{attrs:{id:"dual-master-双主复制-复制架构-master-master-master"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dual-master-双主复制-复制架构-master-master-master"}},[s._v("#")]),s._v(" Dual Master （双主复制）复制架构(Master --- Master) Master)")]),s._v(" "),n("p",[s._v("可以配合一个第三方的工具，比 如keepalived轻松做到IP的漂移， 停机维护也不会影响写操作。")]),s._v(" "),n("p",[n("img",{attrs:{src:e(377),alt:"image"}})]),s._v(" "),n("h3",{attrs:{id:"级联复制架构-master-slaves-slaves"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#级联复制架构-master-slaves-slaves"}},[s._v("#")]),s._v(" 级联复制架构(Master --- Slaves --- Slaves ...) ...)")]),s._v(" "),n("p",[s._v("如果读压力加大，就需要更多的slave来解决，但是如果 slave的复制全部从master复制，势必会加大master的复制 IO的压力，所以就出现了级联复制，减轻master压力。")]),s._v(" "),n("p",[n("img",{attrs:{src:e(378),alt:"image"}})]),s._v(" "),n("p",[s._v("缺点： slave延迟更加大了")]),s._v(" "),n("h3",{attrs:{id:"dual-master-与级联复制结合架构-master-master-slaves"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dual-master-与级联复制结合架构-master-master-slaves"}},[s._v("#")]),s._v(" Dual Master 与级联复制结合架构(Master - Master - Slaves)")]),s._v(" "),n("p",[s._v("这样解决了单点master的问题， 也解决了slave级联延迟的问题.")]),s._v(" "),n("p",[n("img",{attrs:{src:e(379),alt:"image"}})]),s._v(" "),n("h2",{attrs:{id:"replication机制的实现原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#replication机制的实现原理"}},[s._v("#")]),s._v(" Replication机制的实现原理")]),s._v(" "),n("p",[n("img",{attrs:{src:e(380),alt:"image"}})]),s._v(" "),n("h2",{attrs:{id:"mysql数据热备份"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql数据热备份"}},[s._v("#")]),s._v(" mysql数据热备份")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("命令行进入 mysql 的安装目录。如：\n$ cd c:\\Program Files\\MySQL\\MySQL Server 5.7\\bin\n在这个目录下就可以使用 mysqldump 工具。\n\n1. 导出所有数据库\n$ mysqldump -uroot -proot --all-databases >/tmp/all.sql\n2. 导出db1、db2两个数据库的所有数据\n$ mysqldump -uroot -proot --databases db1 db2 >/tmp/db1-db2.sql\n3. 导出db1中的a1、a2表\n$ mysqldump -uroot -proot --databases db1 --tables a1 a2 >/tmp/db1-tables-a1-a2.sql\n4. 条件导出，导出db1表a1中id=1的数据\n$ mysqldump -uroot -proot --databases db1 --tables a1 --where='id=1' >/tmp/a1.sql\n5. 只导出表结构不导出数据，--no-data\n$ mysqldump -uroot -proot --no-data --databases db1 >/tmp/db1.sql\n6. 跨服务器导出并且导入数据\n$ mysqldump --host=h1 -uroot -proot --databases db1 |mysql --host=h2 -uroot -proot db2\n将h1服务器中的db1数据库的所有数据导入到h2中的db2数据库中，db2的数据库必须存在否则会报错。加上 -C 参数可以启用压缩传递。\n$ mysqldump --host=192.168.0.1 -uroot -proot -C --databases test |mysql --host=192.168.0.2 -uroot -proot test \n这里需要注意，如果是热备份，这里需要在dump数据之前进行锁表操作，避免dump数据的时候出 现插入操作导致数据不一致的情况。\n\n3、master 数据库锁表\nmysql> flush table with read lock;\n\n4、slave 数据库导入数据\n$ mysql -uroot -proot < all.sql\n\n5、master 数据库解锁\nmysql> unlock tables;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])]),n("h2",{attrs:{id:"mysql主从复制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql主从复制"}},[s._v("#")]),s._v(" Mysql主从复制")]),s._v(" "),n("h3",{attrs:{id:"docker-容器里面安装-vim"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-容器里面安装-vim"}},[s._v("#")]),s._v(" docker 容器里面安装 vim")]),s._v(" "),n("p",[s._v("进入 docker 容器里面后")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('1. 备份 source.list 文件\n$ mv /etc/apt/sources.list /etc/apt/sources.list.bak\n\n2. 替换为阿里云国内镜像\n$ echo "deb http://mirrors.aliyun.com/debian/ stretch main non-free contrib" >> /etc/apt/sources.list\necho "deb-src http://mirrors.aliyun.com/debian/ stretch main non-free contrib" >> /etc/apt/sources.list\necho "deb http://mirrors.aliyun.com/debian-security stretch/updates main" >> /etc/apt/sources.list\necho "deb-src http://mirrors.aliyun.com/debian-security stretch/updates main" >> /etc/apt/sources.list\necho "deb http://mirrors.aliyun.com/debian/ stretch-updates main non-free contrib" >> /etc/apt/sources.list\necho "deb-src http://mirrors.aliyun.com/debian/ stretch-updates main non-free contrib" >> /etc/apt/sources.list\necho "deb http://mirrors.aliyun.com/debian/ stretch-backports main non-free contrib" >> /etc/apt/sources.list\necho "deb-src http://mirrors.aliyun.com/debian/ stretch-backports main non-free contrib" >> /etc/apt/sources.list\n\n3. 更新安装源\n$ apt-get update\n\n4. 安装 vim\n$ apt-get install libtinfo5\n此时提示: \nYou are about to do something potentially harmful.\nTo continue type in the phrase \'Yes, do as I say!\'?] \n输入：Yes, do as I say!\n \n$ apt-get install vim -y\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("h3",{attrs:{id:"配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),n("p",[s._v("命令：vim /etc/my.cnf")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("master 数据库 my.cnf 添加如下配置\n\nserver-id=135 \n#开启复制功能 \nlog-bin=mysql-bin \n# 自增 id 步长\nauto_increment_increment=2 \n# 自增 id 偏移，例如：1   表示 id 从 1 开始自增，步长为 2， 则生成的id依次为：1，3，5，7，9......\n# 自增 id 偏移，例如：2   表示 id 从 2 开始自增，步长为 2， 则生成的id依次为：2，4，6，8，10......\n# 主从数据库架构这样设置的好处是：当数据同步时，不可能发生自增主键 id 重复的问题。\nauto_increment_offset=1 \n# 数据库表名称小写\nlower_case_table_names=1 \n#binlog-do-db=mstest //要同步的mstest数据库,要同步多个数据库 \n#binlog-ignore-db=mysql //要忽略的数据库\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("slave 数据库 my.cnf 添加如下配置\n\nserver-id=133 \nlog-bin=mysql-bin \nauto-increment-increment=2 \nauto-increment-offset=2 \nlower_case_table_names=1 \n#replicate-do-db=wang #需要同步的数据库 \n#binlog-ignore-db=mysql \n#binlog-ignore-db=information_schema\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("配置完成后，重启 docker 容器")]),s._v(" "),n("h4",{attrs:{id:"完整配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#完整配置"}},[s._v("#")]),s._v(" 完整配置")]),s._v(" "),n("p",[s._v("master: /etc/mysql/conf.d/mysql.cnf")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# For advice on how to change settings please see\n# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html\n\n[mysqld]\n#\n# Remove leading # and set to the amount of RAM for the most important data\n# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.\n# innodb_buffer_pool_size = 128M\n#\n# Remove leading # to turn on a very important data integrity option: logging\n# changes to the binary log between backups.\n# log_bin\n#\n# Remove leading # to set options mainly useful for reporting servers.\n# The server defaults are faster for transactions and fast SELECTs.\n# Adjust sizes as needed, experiment to find the optimal values.\n# join_buffer_size = 128M\n# sort_buffer_size = 2M\n# read_rnd_buffer_size = 2M\ndatadir=/var/lib/mysql\nsocket=/var/lib/mysql/mysql.sock\n\n# Disabling symbolic-links is recommended to prevent assorted security risks\nsymbolic-links=0\n\nlog-error=/var/log/mysqld.log\npid-file=/var/run/mysqld/mysqld.pid\n\ncharacter_set_server=utf8mb4\ninit_connect='SET NAMES utf8mb4' \n\nserver-id=3307\nlog-bin=mysql-bin\nauto_increment_increment=2\nauto_increment_offset=1\nlower_case_table_names=1\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br")])]),n("p",[s._v("slave: /etc/mysql/conf.d/mysql.cnf")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# For advice on how to change settings please see\n# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html\n\n[mysqld]\n#\n# Remove leading # and set to the amount of RAM for the most important data\n# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.\n# innodb_buffer_pool_size = 128M\n#\n# Remove leading # to turn on a very important data integrity option: logging\n# changes to the binary log between backups.\n# log_bin\n#\n# Remove leading # to set options mainly useful for reporting servers.\n# The server defaults are faster for transactions and fast SELECTs.\n# Adjust sizes as needed, experiment to find the optimal values.\n# join_buffer_size = 128M\n# sort_buffer_size = 2M\n# read_rnd_buffer_size = 2M\ndatadir=/var/lib/mysql\nsocket=/var/lib/mysql/mysql.sock\n\n# Disabling symbolic-links is recommended to prevent assorted security risks\nsymbolic-links=0\n\nlog-error=/var/log/mysqld.log\npid-file=/var/run/mysqld/mysqld.pid\n\ncharacter_set_server=utf8mb4\ninit_connect='SET NAMES utf8mb4' \n\nserver-id=3308\nlog-bin=mysql-bin\nauto_increment_increment=2\nauto_increment_offset=2\nlower_case_table_names=1\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br")])]),n("h3",{attrs:{id:"主从复制设置过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主从复制设置过程"}},[s._v("#")]),s._v(" 主从复制设置过程")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1. 在master mysql添加权限\nmysql> GRANT REPLICATION SLAVE,FILE,REPLICATION CLIENT ON *.* TO 'repluser'@'%' IDENTIFIED BY '123456'; \nmysql> FLUSH PRIVILEGES;\n\n2. 在master上查看master的二进制日志\nmysql> show master status;\n+---------------------+---------+---------------+-------------------+-------------------+\n|File                 |Position |Binlog_Do_DB   | Binlog_Ignore_DB  | Executed_Gtid_Set |\n+---------------------+---------+---------------+-------------------+-------------------+\n|mysql-bin.000001     |     154 |               |                   |                   | \n+---------------------+---------+---------------+-------------------+-------------------+\n\n3. 在slave中设置master的信息\nmysql> change master to master_host='192.168.0.1',master_port=3307,master_user='repluser',master_password='123456',master_log_file='mysql-bin.000001',master_log_pos=154;\n\n4. 开启slave，启动SQL和IO线程\nmysql> start slave;\n\n5. 查看slave的状态\nmysql> show slave status \\G\n\n6. 查看二进制日志是否开启\nmysql> show global variables like \"%log%\";\n\n7. 查看进程信息\nmysql> SHOW PROCESSLIST;\n\n8. 允许root远程连接\nmysql> GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'youpassword' WITH GRANT OPTION; \nmysql> FLUSH PRIVILEGES;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("h2",{attrs:{id:"mysql主从半同步复制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql主从半同步复制"}},[s._v("#")]),s._v(" Mysql主从半同步复制")]),s._v(" "),n("h3",{attrs:{id:"准备"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[s._v("#")]),s._v(" 准备")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("加载lib，所有主从节点都要配置")]),s._v(" "),n("ul",[n("li",[s._v("主库：install plugin rpl_semi_sync_master soname 'semisync_master.so';")]),s._v(" "),n("li",[s._v("从库：install plugin rpl_semi_sync_slave soname 'semisync_slave.so';")]),s._v(" "),n("li",[s._v("可以一起装。建议一起装，因为会有主从切换的情景。")])])]),s._v(" "),n("li",[n("p",[s._v("查看，确保所有节点都成功加载")]),s._v(" "),n("ul",[n("li",[s._v("show plugins;")])])]),s._v(" "),n("li",[n("p",[s._v("启用半同步")]),s._v(" "),n("ul",[n("li",[s._v("先启用从库上的参数，最后启用主库的参数\n"),n("ul",[n("li",[s._v("从库：set global rpl_semi_sync_slave_enabled = {0|1}; # 1：启用，0：禁止")]),s._v(" "),n("li",[s._v("主库：\n"),n("ul",[n("li",[s._v("set global rpl_semi_sync_master_enabled = {0|1}; # 1：启用，0：禁止")]),s._v(" "),n("li",[s._v("set global rpl_semi_sync_master_timeout = 10000; # 单位为ms")])])])])]),s._v(" "),n("li",[s._v("风险：endbled写入配置文件的话，会使实例启动后立即进入半同步模式，如果发生长时间断连的实例重新运行启动，有可能导致主库被拖垮。")]),s._v(" "),n("li",[s._v("建议：长时间断开的从库，重新连接后，要等待追完全部事务后，手动开启半同步模式， 而不是启动后直接切换，防止冲击主库。")]),s._v(" "),n("li",[s._v("master的my.cnf配置\n"),n("ul",[n("li",[s._v("[mysqld]")]),s._v(" "),n("li",[s._v("rpl_semi_sync_master_enabled=1")]),s._v(" "),n("li",[s._v("rpl_semi_sync_master_timeout=1000")])])]),s._v(" "),n("li",[s._v("slave的my.cnf配置\n"),n("ul",[n("li",[s._v("[mysqld]")]),s._v(" "),n("li",[s._v("rpl_semi_sync_slave_enabled=1")])])]),s._v(" "),n("li",[s._v("从库重启io_thread\n"),n("ul",[n("li",[s._v("stop slave io_thread;")]),s._v(" "),n("li",[s._v("start slave io_thread;")])])])])]),s._v(" "),n("li",[n("p",[s._v("查询主库状态信息")]),s._v(" "),n("ul",[n("li",[s._v('show global status like "%sync%";')])])]),s._v(" "),n("li",[n("p",[s._v("状态信息重要参数")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("key")]),s._v(" "),n("th",[s._v("description")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("Rpl_semi_sync_master_clients")]),s._v(" "),n("td",[s._v("支持和注册半同步复制的已连Slave数")])]),s._v(" "),n("tr",[n("td",[s._v("Rpl_semi_sync_master_no_times")]),s._v(" "),n("td",[s._v("master关闭半同步复制的次数")])]),s._v(" "),n("tr",[n("td",[s._v("Rpl_semi_sync_master_no_tx")]),s._v(" "),n("td",[s._v("master没有收到slave的回复而提交的次数，可以理解为master等待 超时的次数，即半同步模式不成功提交数量")])]),s._v(" "),n("tr",[n("td",[s._v("Rpl_semi_sync_master_status")]),s._v(" "),n("td",[s._v("ON是活动状态（半同步），OFF是非活动状态（异步），用于表示 主服务器使用的是异步复制模式，还是半同步复制模式")])]),s._v(" "),n("tr",[n("td",[s._v("Rpl_semi_sync_master_tx_avg_wait_time")]),s._v(" "),n("td",[s._v("master花在每个事务上的平均等待时间")])]),s._v(" "),n("tr",[n("td",[s._v("Rpl_semi_sync_master_tx_waits")]),s._v(" "),n("td",[s._v("master等待成功的次数，即master没有等待超时的次数，也就是 成功提交的次数")])]),s._v(" "),n("tr",[n("td",[s._v("Rpl_semi_sync_master_yes_tx")]),s._v(" "),n("td",[s._v("master成功接收到slave的回复的次数，即半同步模式成功提交数量。")])])])])]),s._v(" "),n("li",[n("p",[s._v("查询主库参数信息")]),s._v(" "),n("ul",[n("li",[s._v("show global variables like '%sync%';")])])]),s._v(" "),n("li",[n("p",[s._v("参数信息重要参数")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("key")]),s._v(" "),n("th",[s._v("description")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("rpl_semi_sync_master_enabled")]),s._v(" "),n("td",[s._v("（主库）是否启动半同步")])]),s._v(" "),n("tr",[n("td",[s._v("rpl_semi_sync_master_timeout")]),s._v(" "),n("td",[s._v("等待多时毫秒后变成异步复制，默认是10000ms")])]),s._v(" "),n("tr",[n("td",[s._v("rpl_semi_sync_master_wait_point")]),s._v(" "),n("td",[s._v("5.7默认AFTER_SYNC（增强版半同步复制，无损复制模式），在得 到slave的应答后再commit，可选值AFTER_COMMIT，在master提交后同步数据给slave，然后master等待 slave应答，应答成功返回客户端")])])])])]),s._v(" "),n("li",[n("p",[s._v("after_commit缺点")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("缺点1：幻读。")]),s._v(" 当用户发起一个事务，该事务已经写入redo日志和binlog日志，但该事务还没写入从库，此时处在 waiting slave dump处，此时另一个用户可以读取到这条数据，而他自己却不能；")]),s._v(" "),n("li",[n("strong",[s._v("缺点2：数据丢失。")]),s._v(" 一个事务在waiting slave dump处crash后，主库将比从库多一条数据")])])])]),s._v(" "),n("h3",{attrs:{id:"mysql官网配置信息详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql官网配置信息详解"}},[s._v("#")]),s._v(" mysql官网配置信息详解")]),s._v(" "),n("p",[s._v("https://dev.mysql.com/doc/refman/5.6/en/replication-options-reference.html")]),s._v(" "),n("h3",{attrs:{id:"mysql主从半同步复制的两种模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql主从半同步复制的两种模式"}},[s._v("#")]),s._v(" Mysql主从半同步复制的两种模式")]),s._v(" "),n("h4",{attrs:{id:"after-sync"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#after-sync"}},[s._v("#")]),s._v(" AFTER SYNC")]),s._v(" "),n("p",[s._v("After Sync 是 MySQL5.7官方新加的用以解决MySQL5.6半同步缺陷的选项，也是官方推荐的方式．\n实际上，客户端发出 commit 请求后，在主库上写入 binlog 并推送给 slave，slave 接收到 binlog 并写入 relaylog，发送 ACK 确认已经接收 binlog 后，master 在引擎层 commit，客户端接收 commit 完成，此时其他会话才可以看见已提交的数据．")]),s._v(" "),n("p",[s._v("故障分析：假设 master 在接收 ACK 确认时宕机，因为在引擎层并没有提交，HA 切换到从库，因为 binlog 已经写入从库的 relaylog，因此不会造成数据丢失，个人认为是目前比较完美的解决方式．")]),s._v(" "),n("h4",{attrs:{id:"after-commit"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#after-commit"}},[s._v("#")]),s._v(" AFTER COMMIT")]),s._v(" "),n("p",[s._v("After commit 是 MySQL5.6半同步参数，区别于 after sync , after sync 是在接收 ack 确认以后主库在引攀层做提交，而 after commit 是先在引擎层做提交后等待 ACK 确认。因此，在写入数据后并且在从库确认之前，其他的客户端可以看到在这一事务．\n故障分析：")]),s._v(" "),n("ol",[n("li",[s._v("binlog 未发送到从库：\n事务 B 获取到事务 A 提交的内容．此时宕机故障切换到 slave．事务 B 获取到的内容却丢失了。事务 A commit 没有收到反馈信息（则需要业务判断了）。")]),s._v(" "),n("li",[s._v("binlog 已经发送给从库：\n事务 B 获取到事务 A 提交的内容，故障切换到 slave, B 仍然获取到 A 提交的内容，没毛病。事务 A commit 没有收到反馈信息，若重新执行该事务，则相当于执行两次 A 事务（则需要业务判断了）。")])]),s._v(" "),n("h3",{attrs:{id:"mysql-cluster"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql-cluster"}},[s._v("#")]),s._v(" Mysql Cluster")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1. 创建docker network\n$ docker network create cluster — subnet=192.168.0.0/16\n\n2. 运行管理节点容器 \n$ docker run -d --net=cluster --name=management1 --ip=192.168.0.2 -v /home/mysql-cluster/conf/mysql-cluster.cnf:/etc/mysql-cluster.cnf mysql/mysql-cluster ndb_mgmd\n\n3. 运行数据节点容器\n$ docker run -d --net=cluster --name=ndb1 --ip=192.168.0.3 mysql/mysql-cluster ndbd\n$ docker run -d --net=cluster --name=ndb2 --ip=192.168.0.4 mysql/mysql-cluster ndbd\n\n4. 运行SQL节点容器\n$ docker run -d --net=cluster --name=mysql1 --ip=192.168.0.10 -e MYSQL_ROOT_PASSWORD=123 mysql/mysql-cluster mysqld\n$ docker run -d --net=cluster --name=mysql2 --ip=192.168.0.11 -e MYSQL_ROOT_PASSWORD=123 mysql/mysql-cluster mysqld\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h4",{attrs:{id:"mysql-cluster-cnf配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql-cluster-cnf配置文件"}},[s._v("#")]),s._v(" mysql-cluster.cnf配置文件")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"mysql-高可用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql-高可用"}},[s._v("#")]),s._v(" Mysql 高可用")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SYSLOGD_OPTIONS=\"\" 改为 SYSLOGD_OPTIONS=\"-r -m 2 -c 2\"\n$ vi /etc/sysconfig/rsyslog\n\n创建日志文件\n$ touch /var/log/haproxy.log\n\n启动日志\n$ systemctl restart rsyslog.service\n\n启动haproxy cd /usr/sbin/haproxy\n$ ./haproxy -f /etc/haproxy/haproxy.cfg\n\n在两台数据库添加远程访问权限\n$ GRANT ALL ON *.* TO 'root'@'%' IDENTIFIED BY 'root'; \n$ FLUSH PRIVILEGES;\n\n测试haproxy服务器能否连接到数据库服务器\n安装mysql客户端\n$ yum install -y mysql \n$ mysql -uroot -proot -h 192.168.88.135 \n$ mysql -uroot -proot -h 192.168.88.133\n\n在非haproxy服务器测试通过访问haproxy访问到mysql服务\n$ mysql -uroot -proot -h 192.168.88.132 -P 3300\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("h4",{attrs:{id:"haproxy-docker安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#haproxy-docker安装"}},[s._v("#")]),s._v(" haproxy docker安装")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker run -ti -d -p 3300:3300 -p 1080:1080 --name haproxy -v /home/haproxy/conf/haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg haproxy:1.6.15\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"访问页面-http-192-168-88-132-1080-stats"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#访问页面-http-192-168-88-132-1080-stats"}},[s._v("#")]),s._v(" 访问页面 http://192.168.88.132:1080/stats")]),s._v(" "),n("p",[n("img",{attrs:{src:e(381),alt:"image"}})]),s._v(" "),n("h4",{attrs:{id:"keepalived-源码安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keepalived-源码安装"}},[s._v("#")]),s._v(" keepalived 源码安装")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ wget http://www.keepalived.org/software/keepalived-1.3.5.tar.gz\n$ tar -zxvf keepalived-1.3.5.tar.gz\n安装openssl openssl-devel\n$ yum -y install openssl openssl-devel\n$ ./configure --prefix=/usr/local/keepalived --sbindir=/usr/sbin/ --sysconfdir=/etc/ -- mandir=/usr/local/share/man/\n$ make && make install\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("修改配置\n$ vi /etc/keepalived/keepalived.conf\n$ chmod +x /etc/keepalived/chk.sh")]),s._v(" "),n("h4",{attrs:{id:"keepalived-yum-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keepalived-yum-安装"}},[s._v("#")]),s._v(" keepalived yum 安装")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("预先安装好epel-release源 \n$ yum list installed|grep epel-release\n\n查找可用安装的keepalived源 \n$ yum search keepalived\n\n命令进行安装 \n$ yum install keepalived -y\n\n启动keepalived服务 \n$ systemctl start keepalived\n\n使用yum安装的会有一个默认配置文件模板 路径为/etc/keepalived/keepalived.conf\n\nyum install ipvsadm -y\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("检测mysql的docker容器是否存活脚本")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('mysql -h 192.168.67.140 -u root -p123456 -P 3307 -e "show status;" >/dev/null 2>&1 \nif [ $? == 0 ] \nthen\n    echo " $host mysql login successfully " \n    exit 0 \nelse\n    echo " mysql login faild" \n    killall keepalived \n    exit 2 \nfi\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("脚本语法说明")]),s._v(" "),n("p",[s._v('mysql -h 192.168.67.140 -u root -p123456 -P 3307 -e "show status;" >/dev/null 2>&1 >/dev/null 2>&1 输出”黑洞”\n$? 上一个指令是否执行成功 0 成功 1 失败')])])])}),[],!1,null,null,null);a.default=t.exports}}]);
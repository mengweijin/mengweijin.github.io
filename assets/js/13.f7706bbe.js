(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{382:function(s,e,a){s.exports=a.p+"assets/img/registry-mirrors.d8a523f1.png"},383:function(s,e,a){s.exports=a.p+"assets/img/enabled-kubernetes.13b4c1a3.png"},458:function(s,e,a){"use strict";a.r(e);var n=a(28),t=Object(n.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("先决条件，你需要一个Docker for Windows的安装包，如果没有请下载下载 Docker CE最新版本。")]),s._v(" "),n("p",[s._v("为 Docker daemon 配置 Docker Hub 的中国官方镜像加速 https://registry.docker-cn.com")]),s._v(" "),n("p",[s._v("但是Docker官方加速器也可能down掉，因此建议配置个人阿里云专属加速器。或者多配置几个加速器，会自动切换。\n"),n("img",{attrs:{src:a(382),alt:"image"}})]),s._v(" "),n("h2",{attrs:{id:"docker-for-windows-开启-kubernetes"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-for-windows-开启-kubernetes"}},[s._v("#")]),s._v(" Docker for Windows 开启 Kubernetes")]),s._v(" "),n("p",[s._v("由于Kubernetes大量的容器镜像在 gcr.io， 无法在国内保证稳定的访问。我们提供了一些工具脚本，帮助从阿里云镜像服务下载所需镜像")]),s._v(" "),n("p",[s._v("Github: "),n("a",{attrs:{href:"https://github.com/AliyunContainerService/k8s-for-docker-desktop",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/AliyunContainerService/k8s-for-docker-desktop"),n("OutboundLink")],1)]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 克隆脚本从github")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/AliyunContainerService/k8s-for-docker-desktop.git\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Powershell 进入 clone 后的代码目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" k8s-for-docker-desktop\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切换到你当前 docker desktop 版本的分支：如: v1.19.7")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" checkout v1.19.7\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 预先从阿里云Docker镜像服务下载 Kubernetes 所需要的镜像, 可以通过修改 images.properties 文件加载你自己需要的镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 PowerShell")]),s._v("\n."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("load_images.ps1\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果因为安全策略无法执行 PowerShell 脚本，请在 “以管理员身份运行” 的 PowerShell 中执行如下命令。")]),s._v("\nSet-ExecutionPolicy RemoteSigned\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 Bash shell")]),s._v("\n./load_images.sh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("开启 Kubernetes，并等待 Kubernetes 开始运行\n"),n("img",{attrs:{src:a(383),alt:"image"}})]),s._v(" "),n("h2",{attrs:{id:"配置-kubernetes"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置-kubernetes"}},[s._v("#")]),s._v(" 配置 Kubernetes")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可选操作: 切换Kubernetes运行上下文至 docker-for-desktop")]),s._v("\nkubectl config use-context docker-for-desktop\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证 Kubernetes 集群状态")]),s._v("\nkubectl cluster-info\nkubectl get nodes\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"部署-kubernetes-dashboard"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署-kubernetes-dashboard"}},[s._v("#")]),s._v(" 部署 Kubernetes dashboard")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.4/aio/deploy/recommended.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者： 在目录 C:\\Source\\code\\view\\k8s-for-docker-desktop 下：")]),s._v("\nkubectl create -f kubernetes-dashboard.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查 kubernetes-dashboard 应用状态")]),s._v("\nkubectl get pod -n kubernetes-dashboard\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启 API Server 访问代理")]),s._v("\nkubectl proxy\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过如下 URL 访问 Kubernetes dashboard")]),s._v("\nhttp://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h3",{attrs:{id:"配置控制台访问令牌"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置控制台访问令牌"}},[s._v("#")]),s._v(" 配置控制台访问令牌")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对于Windows环境")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TOKEN")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v("kubectl -n kube-system describe secret default "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Select-String "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"token:"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -split "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('" +"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nkubectl config set-credentials docker-for-desktop --token"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TOKEN}")]),s._v('"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TOKEN")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("登录dashboard的时候，选择 "),n("strong",[s._v("令牌")]),s._v("，然后输入上文控制台输出的内容")]),s._v(" "),n("p",[s._v("或者选择 Kubeconfig 文件,路径如下：Windows: %UserProfile%.kube\\config")]),s._v(" "),n("p",[s._v("点击登陆，进入Kubernetes Dashboard")]),s._v(" "),n("h2",{attrs:{id:"安装-ingress"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装-ingress"}},[s._v("#")]),s._v(" 安装 Ingress")]),s._v(" "),n("p",[s._v("源地址安装说明: "),n("a",{attrs:{href:"https://github.com/kubernetes/ingress-nginx/blob/master/docs/deploy/index.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/kubernetes/ingress-nginx/blob/master/docs/deploy/index.md"),n("OutboundLink")],1)]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 若安装脚本无法安装，可以跳转到上面地址查看最新操作")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装")]),s._v("\nkubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-0.32.0/deploy/static/provider/cloud/deploy.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\nkubectl get pods --all-namespaces -l app.kubernetes.io/name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ingress-nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"测试示例应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试示例应用"}},[s._v("#")]),s._v(" 测试示例应用")]),s._v(" "),n("p",[s._v("部署测试应用，详情参见社区文章: "),n("a",{attrs:{href:"https://matthewpalmer.net/kubernetes-app-developer/articles/kubernetes-ingress-guide-nginx-example.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://matthewpalmer.net/kubernetes-app-developer/articles/kubernetes-ingress-guide-nginx-example.html"),n("OutboundLink")],1)]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例文件可以在这里找到并执行：C:\\Source\\code\\view\\k8s-for-docker-desktop\\sample")]),s._v("\nkubectl create -f sample/apple.yaml\nkubectl create -f sample/banana.yaml\nkubectl create -f sample/ingress.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#测试示例应用")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -kL http://localhost/apple\napple\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -kL http://localhost/banana\nbanana\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -kL http://localhost/notfound\ndefault backend - "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除示例应用")]),s._v("\nkubectl delete -f sample/apple.yaml\nkubectl delete -f sample/banana.yaml\nkubectl delete -f sample/ingress.yaml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h3",{attrs:{id:"卸载-ingress"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#卸载-ingress"}},[s._v("#")]),s._v(" 卸载 Ingress")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubectl delete -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-0.32.0/deploy/static/provider/cloud/deploy.yaml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])}),[],!1,null,null,null);e.default=t.exports}}]);